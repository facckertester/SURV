const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ui-components-BI3DTY02.js","./vendor-react-DxR6__Z7.js","./game-engine-DYSThXx8.js","./services-CVnYLWkH.js"])))=>i.map(i=>d[i]);
import{R as g,r as u,j as e,x as q}from"./vendor-react-DxR6__Z7.js";import{M as H}from"./ui-main-menu-BRdFvWad.js";import{l as U,s as Q,g as Y}from"./services-CVnYLWkH.js";import{W as J}from"./game-engine-DYSThXx8.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(r){if(r.ep)return;r.ep=!0;const l=t(r);fetch(r.href,l)}})();const X="modulepreload",Z=function(n,s){return new URL(n,s).href},k={},y=function(s,t,a){let r=Promise.resolve();if(t&&t.length>0){const i=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),E=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));r=Promise.allSettled(t.map(m=>{if(m=Z(m,a),m in k)return;k[m]=!0;const _=m.endsWith(".css"),O=_?'[rel="stylesheet"]':"";if(!!a)for(let h=i.length-1;h>=0;h--){const x=i[h];if(x.href===m&&(!_||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${O}`))return;const f=document.createElement("link");if(f.rel=_?"stylesheet":X,_||(f.as="script"),f.crossOrigin="",f.href=m,E&&f.setAttribute("nonce",E),document.head.appendChild(f),_)return new Promise((h,x)=>{f.addEventListener("load",h),f.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${m}`)))})}))}function l(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return r.then(i=>{for(const c of i||[])c.status==="rejected"&&l(c.reason);return s().catch(l)})},ee=g.lazy(()=>y(()=>import("./ui-components-BI3DTY02.js").then(n=>n.O),__vite__mapDeps([0,1,2,3]),import.meta.url)),te=g.lazy(()=>y(()=>import("./ui-components-BI3DTY02.js").then(n=>n.U),__vite__mapDeps([0,1,2,3]),import.meta.url)),re=g.lazy(()=>y(()=>import("./ui-components-BI3DTY02.js").then(n=>n.P),__vite__mapDeps([0,1,2,3]),import.meta.url)),se=g.lazy(()=>y(()=>import("./ui-components-BI3DTY02.js").then(n=>n.C),__vite__mapDeps([0,1,2,3]),import.meta.url)),ne=g.lazy(()=>y(()=>import("./ui-components-BI3DTY02.js").then(n=>n.A),__vite__mapDeps([0,1,2,3]),import.meta.url)),oe=g.lazy(()=>y(()=>import("./ui-components-BI3DTY02.js").then(n=>n.L),__vite__mapDeps([0,1,2,3]),import.meta.url)),ae=g.lazy(()=>y(()=>import("./ui-components-BI3DTY02.js").then(n=>n.a),__vite__mapDeps([0,1,2,3]),import.meta.url)),D=()=>e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-950 z-50",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600"}),e.jsx("p",{className:"text-red-500 font-mono text-sm animate-pulse",children:"SUMMONING..."})]})}),le=()=>{const n=u.useRef(null),s=u.useRef(null),[t,a]=u.useState(0),[r,l]=u.useState(null),[i,c]=u.useState(0),[E,m]=u.useState(0),[_,O]=u.useState([]),[P,f]=u.useState({rewards:[],gold:0}),[h,x]=u.useState(""),[L,N]=u.useState(U()),[T,C]=u.useState(!1);u.useEffect(()=>{N(U())},[t===0]),u.useEffect(()=>{const o=d=>{d.code==="Escape"&&(t===4?A(!0):t===5&&A(!1))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[t]);const A=o=>{s.current&&(o?(s.current.isPaused=!0,a(5)):(s.current.isPaused=!1,a(4)))},V=async o=>{if(n.current){C(!0);try{const{GameEngine:d}=await y(async()=>{const{GameEngine:w}=await import("./game-engine-DYSThXx8.js").then(S=>S.E);return{GameEngine:w}},__vite__mapDeps([2,3]),import.meta.url),p=new d(n.current,o,w=>{O(w),a(6),I("LEVEL_UP",p)},w=>{a(7),I("GAME_OVER",p);const S=Q(w);N(S)},()=>{I("BOSS_SPAWN",p)},()=>{B(p)});s.current=p,p.start(),a(4),x("")}catch(d){console.error("Failed to load game engine:",d),alert("Failed to load game resources. Please refresh.")}finally{C(!1)}}},B=o=>{const p=Math.random()<.2?3:1,w=Math.floor(Math.random()*200+100)*o.player.stats.greed,S=[],M=o.player.weapons.filter(b=>b.level<b.maxLevel);for(let b=0;b<p;b++)if(M.length>0){const $=Math.floor(Math.random()*M.length),R=M[$];S.push({id:`chest_upgrade_${R.id}_${Date.now()}_${b}`,name:J[R.id].name,description:`Upgraded to Level ${R.level+1}`,rarity:"rare",type:"WEAPON",apply:W=>{const v=W.weapons.find(K=>K.id===R.id);v.level<v.maxLevel&&(v.level++,v.level%2===0&&(v.damage*=1.2),v.level%3===0&&(v.amount+=1),v.area*=1.1)}})}f({rewards:S,gold:Math.floor(w)}),a(8)},F=()=>{s.current&&(P.rewards.forEach(o=>o.apply(s.current.player)),s.current.goldCollected+=P.gold,s.current.isPaused=!1,a(4))},I=async(o,d)=>{const p=await Y({level:d.player.level,kills:d.score,healthPercent:d.player.hp/d.player.maxHp*100,situation:o});x(p),setTimeout(()=>x(""),4e3)};u.useEffect(()=>{let o;return(t===4||t===5||t===6||t===8)&&s.current&&(o=window.setInterval(()=>{const d=s.current;l({...d.player}),c(d.score),m(Math.floor(d.frameCount/60))},100)),()=>clearInterval(o)},[t]);const G=o=>{s.current&&(o.apply(s.current.player),s.current.isPaused=!1,a(4))},j=()=>{s.current&&(s.current.isGameOver=!0),a(0)};return e.jsxs("div",{className:"relative w-full h-screen bg-slate-900 overflow-hidden",children:[e.jsx("canvas",{ref:n,className:"block w-full h-full"}),T&&e.jsx(D,{}),t===0&&!T&&e.jsx(H,{onStart:V,onAchievements:()=>a(1),onLibrary:()=>a(2),onPowerUp:()=>a(3),stats:L}),e.jsxs(u.Suspense,{fallback:e.jsx(D,{}),children:[t===1&&e.jsx(ne,{stats:L,onBack:j}),t===2&&e.jsx(oe,{stats:L,onBack:j}),t===3&&e.jsx(ae,{stats:L,onBack:j,onUpdateStats:o=>N(o)}),(t===4||t===5)&&e.jsx(ee,{player:r,score:i,time:E,flavorText:h}),t===5&&r&&e.jsx(re,{onResume:()=>A(!1),onQuit:j,stats:{kills:i,time:E,level:r.level}}),t===6&&e.jsx(te,{upgrades:_,onSelect:G}),t===8&&e.jsx(se,{rewards:P.rewards,gold:P.gold,onClose:F})]}),t===7&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-red-900/90 backdrop-blur z-50 animate-in zoom-in duration-500",children:[e.jsx("h2",{className:"text-6xl text-white fantasy-font mb-4 drop-shadow-lg",children:"YOU DIED"}),e.jsxs("div",{className:"text-center mb-8 bg-black/40 p-6 rounded-lg border border-red-500/30",children:[e.jsxs("p",{className:"text-2xl text-red-200 mb-2",children:["Survived: ",Math.floor(E/60),"m ",E%60,"s"]}),e.jsxs("p",{className:"text-2xl text-red-200",children:["Kills: ",i]}),e.jsxs("p",{className:"text-xl text-slate-400 mt-4",children:["Level Reached: ",r==null?void 0:r.level]}),h&&e.jsxs("p",{className:"text-lg italic text-red-300 mt-4 border-t border-red-500/20 pt-4",children:['"',h,'"']})]}),e.jsx("div",{className:"flex gap-4",children:e.jsx("button",{onClick:j,className:"px-8 py-4 bg-white text-red-900 hover:bg-slate-200 rounded text-xl font-bold transition-all border border-red-800",children:"BACK TO MENU"})})]})]})},z=document.getElementById("root");if(!z)throw new Error("Could not find root element to mount to");const ie=q.createRoot(z);ie.render(e.jsx(g.StrictMode,{children:e.jsx(le,{})}));
