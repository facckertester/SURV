const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AchievementsScreen-DupY2OIZ.js","./game-icons-C4FOXNPe.js","./react-vendor-wGySg1uH.js","./LibraryScreen-CYeVD4YL.js","./PowerUpStore-TB3QimLD.js"])))=>i.map(i=>d[i]);
var be=Object.defineProperty;var ve=(o,e,s)=>e in o?be(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var f=(o,e,s)=>ve(o,typeof e!="symbol"?e+"":e,s);import{r as v,a as we,R as B}from"./react-vendor-wGySg1uH.js";import{S as D,C as G,a as Se,H as oe,M as ke,W as $,b as Pe,c as le,d as Te,e as A,B as Me,O as Q,F as je,A as Ee,f as Ne,D as Ie,Z as O,g as Ce,h as re,i as Re,U as Z,L as ee,P as ne,T as Le,j as _e,k as Ae,G as Oe,l as De}from"./game-icons-C4FOXNPe.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(l){if(l.ep)return;l.ep=!0;const r=s(l);fetch(l.href,r)}})();var ce={exports:{}},H={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Be=v,He=Symbol.for("react.element"),Fe=Symbol.for("react.fragment"),ze=Object.prototype.hasOwnProperty,Ue=Be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ke={key:!0,ref:!0,__self:!0,__source:!0};function de(o,e,s){var i,l={},r=null,n=null;s!==void 0&&(r=""+s),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(n=e.ref);for(i in e)ze.call(e,i)&&!Ke.hasOwnProperty(i)&&(l[i]=e[i]);if(o&&o.defaultProps)for(i in e=o.defaultProps,e)l[i]===void 0&&(l[i]=e[i]);return{$$typeof:He,type:o,key:r,ref:n,props:l,_owner:Ue.current}}H.Fragment=Fe;H.jsx=de;H.jsxs=de;ce.exports=H;var a=ce.exports,J={},te=we;J.createRoot=te.createRoot,J.hydrateRoot=te.hydrateRoot;const Ge="modulepreload",We=function(o,e){return new URL(o,e).href},se={},Y=function(e,s,i){let l=Promise.resolve();if(s&&s.length>0){const n=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),t=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));l=Promise.allSettled(s.map(c=>{if(c=We(c,i),c in se)return;se[c]=!0;const h=c.endsWith(".css"),x=h?'[rel="stylesheet"]':"";if(!!i)for(let m=n.length-1;m>=0;m--){const y=n[m];if(y.href===c&&(!h||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${x}`))return;const u=document.createElement("link");if(u.rel=h?"stylesheet":Ge,h||(u.as="script"),u.crossOrigin="",u.href=c,t&&u.setAttribute("nonce",t),document.head.appendChild(u),h)return new Promise((m,y)=>{u.addEventListener("load",m),u.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(n){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=n,window.dispatchEvent(d),!d.defaultPrevented)throw n}return l.then(n=>{for(const d of n||[])d.status==="rejected"&&r(d.reason);return e().catch(r)})};var g=(o=>(o.PLAYER="PLAYER",o.ENEMY="ENEMY",o.GEM="GEM",o.CHEST="CHEST",o.PROJECTILE="PROJECTILE",o.TEXT_PARTICLE="TEXT_PARTICLE",o.VISUAL_PARTICLE="VISUAL_PARTICLE",o.AURA="AURA",o.DESTRUCTIBLE="DESTRUCTIBLE",o.PICKUP="PICKUP",o))(g||{}),S=(o=>(o.BAT="BAT",o.ZOMBIE="ZOMBIE",o.SKELETON="SKELETON",o.GHOST="GHOST",o.BOSS="BOSS",o))(S||{}),T=(o=>(o.GOLD="GOLD",o.CHICKEN="CHICKEN",o.VACUUM="VACUUM",o.ROSARY="ROSARY",o))(T||{});const Ve=100,b={player:"#3b82f6",gem:"#10b981",damageText:"#f87171",background:"#0f0f11",shadowBolt:"#818cf8",obsidianShard:"#475569",spectralShield:"#67e8f9",corrosiveAura:"#84cc16",thunderStrike:"#e879f9",plasmaCutter:"#fb923c",bloodSiphon:"#dc2626",umbralBarrage:"#4c1d95",frostNova:"#22d3ee",whirlingAxe:"#a16207",flameBreath:"#f97316",voidTrap:"#581c87",ricochetBlade:"#94a3b8",vortexOrb:"#7c3aed",infernoGrenade:"#b91c1c",phantomDaggers:"#e2e8f0",destructible:"#b45309",gold:"#fbbf24"},$e={spinach:{name:"Dark Arts",description:"Increases Might by 10%.",maxLevel:5,stat:"might",increase:.1,icon:"skull"},empty_tome:{name:"Chrono Shard",description:"Reduces Cooldowns by 8%.",maxLevel:5,stat:"cooldownReduction",increase:.08,icon:"clock"},candelabrador:{name:"Void Expander",description:"Increases Area by 10%.",maxLevel:5,stat:"area",increase:.1,icon:"maximize"},bracer:{name:"Wind Gauntlet",description:"Increases Projectile Speed by 10%.",maxLevel:5,stat:"speed",increase:.1,icon:"wind"},clover:{name:"Fortune Die",description:"Increases Luck by 10%. Critical hits deal 2x damage.",maxLevel:5,stat:"luck",increase:.1,icon:"clover"},wings:{name:"Swift Boots",description:"Increases Move Speed by 10%.",maxLevel:5,stat:"moveSpeed",increase:.1,icon:"footprints"},attractorb:{name:"Magnetic Amulet",description:"Increases Pickup Range by 25%.",maxLevel:5,stat:"magnet",increase:.25,icon:"magnet"},pummarola:{name:"Regen Heart",description:"Recover 0.2 HP/s.",maxLevel:5,stat:"recovery",increase:.2,icon:"heart"},duplicator:{name:"Mirror Echo",description:"Increases Projectile Amount by 1.",maxLevel:2,stat:"amount",increase:1,icon:"copy"}},Je=[{id:"might",name:"Might",description:"Increases damage dealt by 5%.",icon:"âš”ï¸",baseCost:200,costMultiplier:1.5,maxLevel:5,statKey:"might",valuePerLevel:.05},{id:"armor",name:"Vitality",description:"Increases Max HP by 10%.",icon:"â¤ï¸",baseCost:150,costMultiplier:1.3,maxLevel:5,statKey:"maxHp",valuePerLevel:.1},{id:"recovery",name:"Recovery",description:"Recover 0.2 HP per second.",icon:"ðŸ’–",baseCost:300,costMultiplier:1.7,maxLevel:5,statKey:"recovery",valuePerLevel:.2},{id:"cooldown",name:"Haste",description:"Reduces cooldowns by 2.5%.",icon:"âš¡",baseCost:400,costMultiplier:1.8,maxLevel:5,statKey:"cooldownReduction",valuePerLevel:.025},{id:"area",name:"Area",description:"Increases attack area by 5%.",icon:"ðŸ’¥",baseCost:300,costMultiplier:1.5,maxLevel:5,statKey:"area",valuePerLevel:.05},{id:"speed",name:"Speed",description:"Increases projectile speed by 5%.",icon:"ðŸ¹",baseCost:200,costMultiplier:1.4,maxLevel:3,statKey:"speed",valuePerLevel:.05},{id:"growth",name:"Growth",description:"Increases XP gain by 5%.",icon:"ðŸŒ±",baseCost:500,costMultiplier:2,maxLevel:5,statKey:"growth",valuePerLevel:.05},{id:"greed",name:"Greed",description:"Increases Gold gain by 10%.",icon:"ðŸ’°",baseCost:400,costMultiplier:1.8,maxLevel:5,statKey:"greed",valuePerLevel:.1},{id:"luck",name:"Luck",description:"Increases Crit Chance by 5%.",icon:"ðŸ€",baseCost:600,costMultiplier:2,maxLevel:3,statKey:"luck",valuePerLevel:.05},{id:"magnet",name:"Magnet",description:"Increases pickup range by 15%.",icon:"ðŸ§²",baseCost:250,costMultiplier:1.4,maxLevel:3,statKey:"magnet",valuePerLevel:.15}],ae={BAT:{hp:10,speed:2,damage:5,xp:1,radius:10,color:"#ef4444"},ZOMBIE:{hp:25,speed:1.2,damage:10,xp:3,radius:14,color:"#22c55e"},SKELETON:{hp:50,speed:1.5,damage:15,xp:5,radius:14,color:"#cbd5e1"},GHOST:{hp:15,speed:2.8,damage:8,xp:2,radius:12,color:"#94a3b8"},BOSS:{hp:3e3,speed:2.5,damage:40,xp:1e3,radius:45,color:"#a855f7"}},C=[{id:"kael",name:"Kael",title:"The Riftwalker",description:"Balanced stats. Starts with Shadow Bolt.",unlockCondition:"Unlocked by default.",isUnlocked:()=>!0,baseStats:{maxHp:100,speed:3.5,might:1,area:1,cooldownReduction:0},startingWeaponId:"shadow_bolt",color:"#3b82f6"},{id:"lyra",name:"Lyra",title:"Pyromancer",description:"High damage, low HP. Starts with Plasma Cutter.",unlockCondition:"Kill 500 enemies total.",isUnlocked:o=>o.totalKills>=500,baseStats:{maxHp:70,speed:4,might:1.3,area:1.1,cooldownReduction:0},startingWeaponId:"plasma_cutter",color:"#fb923c"},{id:"grom",name:"Grom",title:"Ironclad",description:"Very tanky, slow. Starts with Obsidian Shard.",unlockCondition:"Survive for 10 minutes total.",isUnlocked:o=>o.totalTime>=600,baseStats:{maxHp:160,speed:2.8,might:1.1,area:1.2,cooldownReduction:0},startingWeaponId:"obsidian_shard",color:"#475569"},{id:"vex",name:"Vex",title:"Void Soul",description:"Fast cooldowns, fragile. Starts with Spectral Shield.",unlockCondition:"Reach Level 10 in a single run.",isUnlocked:o=>o.maxLevel>=10,baseStats:{maxHp:50,speed:3.8,might:.9,area:1,cooldownReduction:.2},startingWeaponId:"spectral_shield",color:"#a855f7"},{id:"seraphina",name:"Seraphina",title:"Wind Dancer",description:"Incredibly fast. High cooldown reduction. Starts with Spectral Shield.",unlockCondition:"Collect 1000 gems in total.",isUnlocked:o=>(o.totalGems||0)>=1e3,baseStats:{maxHp:60,speed:4.5,might:.9,area:1,cooldownReduction:.25},startingWeaponId:"spectral_shield",color:"#f472b6"},{id:"darius",name:"Darius",title:"Crimson Lord",description:"Sustains through bloodshed. Starts with Blood Siphon.",unlockCondition:"Kill 1500 enemies total.",isUnlocked:o=>o.totalKills>=1500,baseStats:{maxHp:140,speed:3.2,might:1,area:1,cooldownReduction:0},startingWeaponId:"blood_siphon",color:"#dc2626"},{id:"isolde",name:"Isolde",title:"Frost Queen",description:"Master of cold. Starts with Frost Nova.",unlockCondition:"Reach Level 25 in a single run.",isUnlocked:o=>o.maxLevel>=25,baseStats:{maxHp:80,speed:3.4,might:1.1,area:1.3,cooldownReduction:.1},startingWeaponId:"frost_nova",color:"#06b6d4"},{id:"grimwald",name:"Grimwald",title:"The Executioner",description:"Brutal melee fighter. Starts with Whirling Axe.",unlockCondition:"Kill 3000 enemies total.",isUnlocked:o=>o.totalKills>=3e3,baseStats:{maxHp:150,speed:3,might:1.4,area:1,cooldownReduction:0},startingWeaponId:"whirling_axe",color:"#d97706"},{id:"ignis",name:"Ignis",title:"The Bombardier",description:"Explosive expert. Starts with Inferno Grenade.",unlockCondition:"Kill 4000 enemies total.",isUnlocked:o=>o.totalKills>=4e3,baseStats:{maxHp:120,speed:2.6,might:1.5,area:1.2,cooldownReduction:0},startingWeaponId:"inferno_grenade",color:"#b91c1c"},{id:"elara",name:"Elara",title:"Phantom Blade",description:"Swift and deadly. Starts with Phantom Daggers.",unlockCondition:"Survive for 25 minutes total.",isUnlocked:o=>o.totalTime>=1500,baseStats:{maxHp:75,speed:4.2,might:1.1,area:1,cooldownReduction:.1},startingWeaponId:"phantom_daggers",color:"#cbd5e1"}],R={shadow_bolt:{name:"Shadow Bolt",description:"Fires energy bolts at nearest enemy.",unlockCondition:()=>!0,unlockText:"Unlocked"},obsidian_shard:{name:"Obsidian Shard",description:"Lobs heavy rocks in a high arc.",unlockCondition:o=>o.maxLevel>=5,unlockText:"Reach Level 5."},spectral_shield:{name:"Spectral Shield",description:"Revolving energy crystals protect you.",unlockCondition:o=>o.totalKills>=200,unlockText:"Kill 200 enemies."},corrosive_aura:{name:"Corrosive Aura",description:"Creates a toxic zone around you.",unlockCondition:o=>o.totalTime>=300,unlockText:"Survive 5 minutes."},thunder_strike:{name:"Thunder Strike",description:"Calls down orbital lightning strikes.",unlockCondition:o=>o.bossesKilled>=1,unlockText:"Kill a Boss."},plasma_cutter:{name:"Plasma Cutter",description:"Shoots a piercing wave horizontally.",unlockCondition:o=>o.gamesPlayed>=3,unlockText:"Play 3 games."},blood_siphon:{name:"Blood Siphon",description:"Projectile that heals you on hit.",unlockCondition:o=>o.totalKills>=1e3,unlockText:"Kill 1000 enemies."},frost_nova:{name:"Frost Nova",description:"Emits a freezing pulse that damages nearby enemies.",unlockCondition:o=>o.maxLevel>=15,unlockText:"Reach Level 15."},whirling_axe:{name:"Whirling Axe",description:"Spirals outward, slicing everything in its path.",unlockCondition:o=>o.totalKills>=2500,unlockText:"Kill 2500 enemies."},flame_breath:{name:"Flame Breath",description:"Spews a cone of fire in front of you.",unlockCondition:o=>o.totalTime>=1200,unlockText:"Survive 20 minutes."},void_trap:{name:"Void Trap",description:"Places a zone that damages enemies inside it.",unlockCondition:o=>o.gamesPlayed>=5,unlockText:"Play 5 games."},ricochet_blade:{name:"Ricochet Blade",description:"Bounces between multiple enemies.",unlockCondition:o=>(o.maxKills||0)>=300,unlockText:"Get 300 kills in one run."},vortex_orb:{name:"Vortex Orb",description:"Pulls nearby enemies into a crushing void.",unlockCondition:o=>o.maxLevel>=30,unlockText:"Reach Level 30."},inferno_grenade:{name:"Inferno Grenade",description:"Explodes on impact, dealing massive area damage.",unlockCondition:o=>o.totalKills>=4e3,unlockText:"Kill 4000 enemies."},phantom_daggers:{name:"Phantom Daggers",description:"Fires a spread of daggers behind you.",unlockCondition:o=>o.totalTime>=1500,unlockText:"Survive 25 minutes."}},xt=[{id:"novice_hunter",title:"Novice Hunter",description:"Kill 500 enemies in total.",condition:o=>o.totalKills>=500,icon:"ðŸ—¡ï¸"},{id:"veteran_slayer",title:"Veteran Slayer",description:"Kill 5,000 enemies in total.",condition:o=>o.totalKills>=5e3,icon:"ðŸ’€"},{id:"elite_slayer",title:"Elite Slayer",description:"Kill 20,000 enemies in total.",condition:o=>o.totalKills>=2e4,icon:"ðŸ©¸"},{id:"gold_rush",title:"Gold Rush",description:"Collect 5,000 Gold total.",condition:o=>(o.gold||0)>=5e3,icon:"ðŸª™"},{id:"midas_touch",title:"Midas Touch",description:"Collect 50,000 Gold total.",condition:o=>(o.gold||0)>=5e4,icon:"ðŸ‘‘"},{id:"rampage",title:"Rampage",description:"Kill 1,500 enemies in a single run.",condition:o=>(o.maxKills||0)>=1500,icon:"ðŸŒªï¸"},{id:"annihilator",title:"Annihilator",description:"Kill 3,000 enemies in a single run.",condition:o=>(o.maxKills||0)>=3e3,icon:"â˜„ï¸"},{id:"weapon_collector",title:"Weapon Collector",description:"Unlock 5 different weapons.",condition:o=>Object.values(R).filter(e=>e.unlockCondition(o)).length>=5,icon:"ðŸ›¡ï¸"},{id:"master_of_arms",title:"Master of Arms",description:"Unlock 10 different weapons.",condition:o=>Object.values(R).filter(e=>e.unlockCondition(o)).length>=10,icon:"âš”ï¸"},{id:"seasoned_veteran",title:"Seasoned Veteran",description:"Play 50 games.",condition:o=>o.gamesPlayed>=50,icon:"ðŸŽ–ï¸"},{id:"immortal",title:"Immortal",description:"Play for a total of 5 hours.",condition:o=>o.totalTime>=18e3,icon:"ðŸ•°ï¸"},{id:"technomancer",title:"Technomancer",description:"Purchase 20 Power Up levels.",condition:o=>Object.values(o.powerUps||{}).reduce((e,s)=>e+s,0)>=20,icon:"ðŸ’¸"},{id:"survivor",title:"Survivor",description:"Survive for a total of 30 minutes.",condition:o=>o.totalTime>=1800,icon:"â³"},{id:"marathon",title:"Marathon",description:"Play for a total of 2 hours.",condition:o=>o.totalTime>=7200,icon:"ðŸƒ"},{id:"awakened",title:"Awakened",description:"Reach Level 20 in a single run.",condition:o=>o.maxLevel>=20,icon:"âœ¨"},{id:"master_survivor",title:"Master Survivor",description:"Reach Level 40 in a single run.",condition:o=>o.maxLevel>=40,icon:"ðŸŒŸ"},{id:"boss_slayer",title:"Boss Slayer",description:"Defeat a Boss.",condition:o=>o.bossesKilled>=1,icon:"ðŸ‘‘"},{id:"boss_hunter",title:"Boss Hunter",description:"Defeat 5 Bosses total.",condition:o=>o.bossesKilled>=5,icon:"ðŸ‘¹"},{id:"treasure_hunter",title:"Treasure Hunter",description:"Collect 2,000 gems in total.",condition:o=>(o.totalGems||0)>=2e3,icon:"ðŸ’Ž"},{id:"gem_hoarder",title:"Gem Hoarder",description:"Collect 10,000 gems in total.",condition:o=>(o.totalGems||0)>=1e4,icon:"ðŸ’°"},{id:"dedicated",title:"Dedicated",description:"Play 10 games.",condition:o=>o.gamesPlayed>=10,icon:"ðŸŽ®"}],q="crimson_survivor_stats_v3",W={totalKills:0,totalTime:0,maxLevel:1,gamesPlayed:0,bossesKilled:0,unlockedWeapons:["shadow_bolt"],totalGems:0,maxKills:0,gold:0,powerUps:{}},L=()=>{try{const o=localStorage.getItem(q);if(!o)return W;const e=JSON.parse(o);return{...W,...e}}catch(o){return console.error("Failed to load stats",o),W}},Ye=o=>{const e=L();let s={...e};o&&(s={...e,totalKills:e.totalKills+o.kills,totalTime:e.totalTime+o.time,maxLevel:Math.max(e.maxLevel,o.level),gamesPlayed:e.gamesPlayed+1,bossesKilled:e.bossesKilled+(o.bossKilled?1:0),totalGems:(e.totalGems||0)+o.gemsCollected,maxKills:Math.max(e.maxKills||0,o.kills),gold:(e.gold||0)+o.goldCollected});try{localStorage.setItem(q,JSON.stringify(s))}catch(i){console.error("Failed to save stats",i)}return s},pt=o=>{try{localStorage.setItem(q,JSON.stringify(o))}catch(e){console.error("Failed to save stats",e)}};class qe{constructor(e,s,i,l,r,n){f(this,"canvas");f(this,"ctx");f(this,"bgPattern",null);f(this,"player");f(this,"enemies",[]);f(this,"gems",[]);f(this,"chests",[]);f(this,"destructibles",[]);f(this,"pickups",[]);f(this,"projectiles",[]);f(this,"damageTexts",[]);f(this,"particles",[]);f(this,"keys",new Set);f(this,"frameCount",0);f(this,"score",0);f(this,"gemsCollected",0);f(this,"goldCollected",0);f(this,"isPaused",!1);f(this,"isGameOver",!1);f(this,"bossKilled",!1);f(this,"lastTime",0);f(this,"accumulator",0);f(this,"FIXED_TIME_STEP",1e3/60);f(this,"onLevelUp");f(this,"onGameOver");f(this,"onBossSpawn");f(this,"onChestOpen");f(this,"loop",e=>{if(requestAnimationFrame(this.loop),this.isPaused||this.isGameOver){this.lastTime=e;return}const s=e-this.lastTime;if(this.lastTime=e,s>250){this.accumulator=0;return}this.accumulator+=s;let i=0;for(;this.accumulator>=this.FIXED_TIME_STEP;)if(this.update(),this.accumulator-=this.FIXED_TIME_STEP,i++,i>240){this.accumulator=0;break}this.draw()});this.canvas=e,this.ctx=e.getContext("2d",{alpha:!1}),this.onLevelUp=i,this.onGameOver=l,this.onBossSpawn=r,this.onChestOpen=n;const d=window.devicePixelRatio||1;this.canvas.width=window.innerWidth*d,this.canvas.height=window.innerHeight*d,this.ctx.scale(d,d),this.createBackgroundPattern(),this.player=this.createPlayer(s),window.addEventListener("keydown",t=>this.keys.add(t.code)),window.addEventListener("keyup",t=>this.keys.delete(t.code)),window.addEventListener("resize",()=>{const t=window.devicePixelRatio||1;this.canvas.width=window.innerWidth*t,this.canvas.height=window.innerHeight*t,this.ctx.scale(t,t),this.createBackgroundPattern()})}createBackgroundPattern(){const s=document.createElement("canvas");s.width=256,s.height=256;const i=s.getContext("2d");i.fillStyle="#0a0a0c",i.fillRect(0,0,256,256);for(let l=0;l<40;l++){i.fillStyle=Math.random()>.5?"#111113":"#050505";const r=Math.random()*40+10;i.fillRect(Math.random()*256,Math.random()*256,r,r)}i.strokeStyle="#1a1a1e",i.lineWidth=2,i.beginPath(),i.moveTo(0,256),i.lineTo(256,0),i.stroke(),i.strokeStyle="#141416",i.lineWidth=1,i.strokeRect(0,0,256,256),this.bgPattern=this.ctx.createPattern(s,"repeat")}createPlayer(e){const s=C.find(y=>y.id===e)||C[0],i=L();let l=0,r=0,n=0,d=0,t=0,c=0,h=0,x=0,p=0,u=0;Je.forEach(y=>{const P=(i.powerUps[y.id]||0)*y.valuePerLevel;switch(y.statKey){case"might":l+=P;break;case"maxHp":r+=s.baseStats.maxHp*P;break;case"recovery":n+=P;break;case"cooldownReduction":d+=P;break;case"area":t+=P;break;case"speed":c+=P;break;case"growth":h+=P;break;case"greed":x+=P;break;case"luck":p+=P;break;case"magnet":u+=P;break}});const m=this.getWeaponConfig(s.startingWeaponId);return{id:"player",type:g.PLAYER,characterId:s.id,pos:{x:window.innerWidth/2,y:window.innerHeight/2},radius:12,color:s.color,markedForDeletion:!1,hp:s.baseStats.maxHp+r,maxHp:s.baseStats.maxHp+r,speed:s.baseStats.speed,pickupRange:Ve*(1+u),weapons:[m],passives:[],xp:0,level:1,nextLevelXp:50,facingRight:!0,stats:{might:s.baseStats.might+l,cooldownReduction:Math.min(.5,s.baseStats.cooldownReduction+d),area:s.baseStats.area+t,speed:1+c,lifesteal:s.baseStats.lifesteal||0,greed:1+x,growth:1+h,luck:p,recovery:n,amount:0,moveSpeed:1,magnet:1+u}}}getWeaponConfig(e){switch(e){case"shadow_bolt":return{id:e,name:"Shadow Bolt",description:"Fires energy bolts.",level:1,maxLevel:8,cooldown:50,cooldownTimer:0,damage:15,area:1,speed:7,duration:60,amount:1,type:"PROJECTILE"};case"umbral_barrage":return{id:e,name:"Umbral Barrage",description:"Evolution: Void destruction.",level:1,maxLevel:1,cooldown:45,cooldownTimer:0,damage:25,area:1.5,speed:8,duration:80,amount:5,type:"PROJECTILE"};case"obsidian_shard":return{id:e,name:"Obsidian Shard",description:"Heavy lobbed projectile.",level:1,maxLevel:8,cooldown:80,cooldownTimer:0,damage:35,area:1.5,speed:1,duration:120,amount:1,type:"PROJECTILE"};case"spectral_shield":return{id:e,name:"Spectral Shield",description:"Orbiting crystals.",level:1,maxLevel:8,cooldown:180,cooldownTimer:0,damage:15,area:1.2,speed:1,duration:180,amount:1,type:"ORBITAL"};case"corrosive_aura":return{id:e,name:"Corrosive Aura",description:"Toxic zone.",level:1,maxLevel:8,cooldown:30,cooldownTimer:0,damage:5,area:1.2,speed:0,duration:0,amount:1,type:"AURA"};case"thunder_strike":return{id:e,name:"Thunder Strike",description:"Orbital lightning.",level:1,maxLevel:8,cooldown:90,cooldownTimer:0,damage:50,area:1,speed:0,duration:0,amount:2,type:"INSTANT"};case"plasma_cutter":return{id:e,name:"Plasma Cutter",description:"Horizontal wave.",level:1,maxLevel:8,cooldown:60,cooldownTimer:0,damage:25,area:1,speed:8,duration:100,amount:1,type:"PROJECTILE"};case"blood_siphon":return{id:e,name:"Blood Siphon",description:"Heals on hit.",level:1,maxLevel:8,cooldown:70,cooldownTimer:0,damage:10,area:1,speed:6,duration:60,amount:1,type:"PROJECTILE"};case"frost_nova":return{id:e,name:"Frost Nova",description:"Freezing pulse.",level:1,maxLevel:8,cooldown:180,cooldownTimer:0,damage:10,area:1.5,speed:0,duration:0,amount:1,type:"INSTANT"};case"whirling_axe":return{id:e,name:"Whirling Axe",description:"Spiraling projectile.",level:1,maxLevel:8,cooldown:120,cooldownTimer:0,damage:20,area:1,speed:5,duration:150,amount:1,type:"PROJECTILE"};case"flame_breath":return{id:e,name:"Flame Breath",description:"Spews a cone of fire in front of you.",level:1,maxLevel:8,cooldown:90,cooldownTimer:0,damage:8,area:1,speed:5,duration:40,amount:3,type:"PROJECTILE"};case"void_trap":return{id:e,name:"Void Trap",description:"Static damaging zone.",level:1,maxLevel:8,cooldown:200,cooldownTimer:0,damage:4,area:1,speed:0,duration:300,amount:1,type:"PROJECTILE"};case"ricochet_blade":return{id:e,name:"Ricochet Blade",description:"Bouncing blade.",level:1,maxLevel:8,cooldown:70,cooldownTimer:0,damage:15,area:1,speed:7,duration:180,amount:1,type:"PROJECTILE"};case"vortex_orb":return{id:e,name:"Vortex Orb",description:"Pulls enemies in.",level:1,maxLevel:8,cooldown:180,cooldownTimer:0,damage:5,area:1.2,speed:2,duration:180,amount:1,type:"PROJECTILE"};case"inferno_grenade":return{id:e,name:"Inferno Grenade",description:"Explodes on impact.",level:1,maxLevel:8,cooldown:100,cooldownTimer:0,damage:40,area:1.5,speed:1,duration:80,amount:1,type:"PROJECTILE"};case"phantom_daggers":return{id:e,name:"Phantom Daggers",description:"Fires backwards.",level:1,maxLevel:8,cooldown:45,cooldownTimer:0,damage:15,area:1,speed:8,duration:80,amount:2,type:"PROJECTILE"};default:return{id:e,name:"Unknown",description:"?",level:1,maxLevel:1,cooldown:100,cooldownTimer:0,damage:1,area:1,speed:1,duration:1,amount:1,type:"PROJECTILE"}}}start(){this.lastTime=performance.now(),requestAnimationFrame(this.loop)}update(){this.frameCount++,this.player.stats.recovery>0&&this.frameCount%60===0&&(this.player.hp=Math.min(this.player.maxHp,this.player.hp+this.player.stats.recovery));let e=0,s=0;if((this.keys.has("ArrowUp")||this.keys.has("KeyW"))&&(s-=1),(this.keys.has("ArrowDown")||this.keys.has("KeyS"))&&(s+=1),(this.keys.has("ArrowLeft")||this.keys.has("KeyA"))&&(e-=1,this.player.facingRight=!1),(this.keys.has("ArrowRight")||this.keys.has("KeyD"))&&(e+=1,this.player.facingRight=!0),e!==0||s!==0){const i=Math.sqrt(e*e+s*s),l=this.player.speed*this.player.stats.moveSpeed;this.player.pos.x+=e/i*l,this.player.pos.y+=s/i*l}(isNaN(this.player.pos.x)||isNaN(this.player.pos.y))&&(this.player.pos={x:window.innerWidth/2,y:window.innerHeight/2}),this.handleSpawning(),this.updateEnemies(),this.updateProjectiles(),this.updateGems(),this.updateWeapons(),this.updateParticles(),this.updateChests(),this.updateDestructibles(),this.updatePickups(),this.checkCollisions(),this.cleanup()}handleSpawning(){const e=1+this.frameCount/3600,s=Math.max(5,Math.floor(50/e));this.frameCount%s===0&&this.spawnEnemy(),this.frameCount>0&&this.frameCount%3600===0&&this.spawnBoss(),this.frameCount%300===0&&this.destructibles.length<10&&this.spawnDestructible()}spawnEnemy(){const e=Math.random()*Math.PI*2,s=Math.max(window.innerWidth,window.innerHeight)/2+100,i={x:this.player.pos.x+Math.cos(e)*s,y:this.player.pos.y+Math.sin(e)*s};let l=S.BAT;const r=this.frameCount/3600,n=Math.random();r>5?n<.2?l=S.GHOST:n<.5?l=S.SKELETON:l=S.ZOMBIE:r>2?n<.1?l=S.GHOST:n<.6?l=S.SKELETON:l=S.ZOMBIE:r>1&&(n<.6?l=S.ZOMBIE:l=S.BAT);const d=ae[l];this.enemies.push({id:Math.random().toString(36),type:g.ENEMY,enemyType:l,pos:i,radius:d.radius,color:d.color,hp:d.hp*(1+r*.4),maxHp:d.hp*(1+r*.4),speed:d.speed+r*.1,damage:d.damage,xpValue:d.xp,opacity:l===S.GHOST?.6:1,markedForDeletion:!1,animationOffset:Math.random()*Math.PI*2,visualVariant:Math.floor(Math.random()*3)})}spawnDestructible(){const e=Math.random()*Math.PI*2,s=400+Math.random()*200;this.destructibles.push({id:"dest_"+Date.now(),type:g.DESTRUCTIBLE,pos:{x:this.player.pos.x+Math.cos(e)*s,y:this.player.pos.y+Math.sin(e)*s},hp:1,radius:15,color:b.destructible,markedForDeletion:!1})}spawnBoss(){const e=Math.random()*Math.PI*2,s=Math.max(window.innerWidth,window.innerHeight)/2+150,i=ae.BOSS;this.enemies.push({id:"boss-"+Date.now(),type:g.ENEMY,enemyType:S.BOSS,pos:{x:this.player.pos.x+Math.cos(e)*s,y:this.player.pos.y+Math.sin(e)*s},radius:i.radius,color:i.color,hp:i.hp*(1+this.frameCount/3600*.8),maxHp:i.hp,speed:i.speed,damage:i.damage,xpValue:i.xp,markedForDeletion:!1,animationOffset:0,visualVariant:0}),this.onBossSpawn()}updateEnemies(){this.enemies.forEach(e=>{if(e.stunTimer&&e.stunTimer>0){e.stunTimer--;return}const s=this.player.pos.x-e.pos.x,i=this.player.pos.y-e.pos.y,l=Math.sqrt(s*s+i*i);l>0&&(e.pos.x+=s/l*e.speed,e.pos.y+=i/l*e.speed),this.enemies.forEach(r=>{if(e===r)return;const n=e.pos.x-r.pos.x,d=e.pos.y-r.pos.y,t=Math.sqrt(n*n+d*d);t<e.radius+r.radius&&t>0&&(e.pos.x+=n/t*.05,e.pos.y+=d/t*.05)})})}updateProjectiles(){this.projectiles.forEach(e=>{e.behavior==="STRAIGHT"?(e.pos.x+=e.velocity.x,e.pos.y+=e.velocity.y):e.behavior==="ARC"?(e.pos.x+=e.velocity.x,e.pos.y+=e.velocity.y,e.gravity&&(e.velocity.y+=e.gravity)):e.behavior==="ORBIT"?e.orbitAngle!==void 0&&e.orbitDistance!==void 0&&e.orbitSpeed!==void 0&&(e.orbitAngle+=e.orbitSpeed,e.orbitGrowth&&e.orbitGrowth>0&&(e.orbitDistance+=e.orbitGrowth),e.pos.x=this.player.pos.x+Math.cos(e.orbitAngle)*e.orbitDistance,e.pos.y=this.player.pos.y+Math.sin(e.orbitAngle)*e.orbitDistance):e.behavior,e.pullRadius&&e.pullForce&&this.enemies.forEach(s=>{const i=e.pos.x-s.pos.x,l=e.pos.y-s.pos.y,r=Math.sqrt(i*i+l*l);r<e.pullRadius&&(s.pos.x+=i/r*e.pullForce,s.pos.y+=l/r*e.pullForce)}),e.duration===1&&e.onHitEffect==="EXPLODE"&&this.triggerExplosion(e),e.duration--,e.duration<=0&&(e.markedForDeletion=!0)})}updateGems(){this.gems.forEach(e=>{const s=this.player.pos.x-e.pos.x,i=this.player.pos.y-e.pos.y,l=Math.sqrt(s*s+i*i),r=this.player.pickupRange*this.player.stats.magnet;if(e.isVacuumed||l<r){const n=e.isVacuumed?15:8+(r-l)*.1;e.pos.x+=s/l*n,e.pos.y+=i/l*n,l<this.player.radius&&(this.player.xp+=e.value*this.player.stats.growth,this.gemsCollected++,e.markedForDeletion=!0,this.checkLevelUp())}})}updateDestructibles(){}updatePickups(){this.pickups.forEach(e=>{const s=this.player.pos.x-e.pos.x,i=this.player.pos.y-e.pos.y,l=Math.sqrt(s*s+i*i),r=this.player.pickupRange*this.player.stats.magnet;l<r&&(e.pos.x+=s/l*8,e.pos.y+=i/l*8,l<this.player.radius&&(this.applyPickupEffect(e),e.markedForDeletion=!0))})}applyPickupEffect(e){switch(e.pickupType){case T.GOLD:const s=Math.ceil(e.value*this.player.stats.greed);this.goldCollected+=s,this.addDamageText(this.player.pos,s,!1,"HEAL");break;case T.CHICKEN:this.player.hp=Math.min(this.player.maxHp,this.player.hp+e.value),this.addDamageText(this.player.pos,e.value,!1,"HEAL");break;case T.VACUUM:this.gems.forEach(r=>r.isVacuumed=!0);break;case T.ROSARY:const i=window.innerWidth,l=window.innerHeight;this.enemies.forEach(r=>{r.enemyType!==S.BOSS&&Math.abs(r.pos.x-this.player.pos.x)<i/2+100&&Math.abs(r.pos.y-this.player.pos.y)<l/2+100&&(r.hp=0,this.handleEnemyDeath(r))}),this.particles.push({id:Math.random().toString(),type:g.VISUAL_PARTICLE,pos:{...this.player.pos},life:10,maxLife:10,renderType:"EXPLOSION",radius:0,color:"#fff",markedForDeletion:!1});break}}updateChests(){this.chests.forEach(e=>{const s=this.player.pos.x-e.pos.x,i=this.player.pos.y-e.pos.y;Math.sqrt(s*s+i*i)<this.player.radius+e.radius&&(e.markedForDeletion=!0,this.isPaused=!0,this.onChestOpen())})}updateParticles(){this.particles.forEach(e=>{e.velocity&&(e.pos.x+=e.velocity.x,e.pos.y+=e.velocity.y,e.velocity.x*=.95,e.velocity.y*=.95),e.gravity&&(e.velocity||(e.velocity={x:0,y:0}),e.velocity.y+=e.gravity),e.life--,e.life<=0&&(e.markedForDeletion=!0)}),this.damageTexts.forEach(e=>{e.pos.x+=e.velocity.x,e.pos.y+=e.velocity.y,e.life-=.02,e.opacity=Math.max(0,e.life),e.life<=0&&(e.markedForDeletion=!0)})}updateWeapons(){this.player.weapons.forEach(e=>{const s=e.cooldown*(1-this.player.stats.cooldownReduction),i=e.amount+this.player.stats.amount;if(e.cooldownTimer>0&&e.cooldownTimer--,e.cooldownTimer<=0)if(e.id==="shadow_bolt")this.fireShadowBolt(e,i),e.cooldownTimer=s;else if(e.id==="umbral_barrage")this.fireUmbralBarrage(e,i),e.cooldownTimer=s;else if(e.id==="obsidian_shard"){for(let l=0;l<i;l++){const r=(l-(i-1)/2)*.3;this.fireObsidian(e,r)}e.cooldownTimer=s}else if(e.id==="corrosive_aura")this.pulseCorrosive(e),e.cooldownTimer=s;else if(e.id==="thunder_strike")this.strikeThunder(e,i),e.cooldownTimer=s;else if(e.id==="plasma_cutter")this.firePlasma(e),e.cooldownTimer=s;else if(e.id==="blood_siphon")this.fireBloodSiphon(e,i),e.cooldownTimer=s;else if(e.id==="frost_nova")this.fireFrostNova(e),e.cooldownTimer=s;else if(e.id==="whirling_axe"){for(let l=0;l<i;l++)setTimeout(()=>this.spawnWhirlingAxe(e,l,i),l*500);e.cooldownTimer=s}else e.id==="flame_breath"?(this.fireFlameBreath(e,i),e.cooldownTimer=s):e.id==="void_trap"?(this.spawnVoidTrap(e),e.cooldownTimer=s):e.id==="ricochet_blade"?(this.fireRicochetBlade(e),e.cooldownTimer=s):e.id==="vortex_orb"?(this.fireVortexOrb(e),e.cooldownTimer=s):e.id==="inferno_grenade"?(this.fireInfernoGrenade(e),e.cooldownTimer=s):e.id==="phantom_daggers"&&(this.firePhantomDaggers(e,i),e.cooldownTimer=s);if(e.id==="spectral_shield"&&this.projectiles.filter(r=>r.weaponId==="spectral_shield"&&!r.markedForDeletion).length<i&&e.cooldownTimer<=0){for(let r=0;r<i;r++)this.spawnShield(e,r,i);e.cooldownTimer=s+e.duration}})}fireShadowBolt(e,s){this.genericFire(e,s,"STRAIGHT",b.shadowBolt)}fireUmbralBarrage(e,s){const i=this.getNearestEnemy();if(!i)return;const l=i.pos.x-this.player.pos.x,r=i.pos.y-this.player.pos.y,n=Math.atan2(r,l);for(let d=0;d<s;d++){const c=n-.2*(s-1)/2+.2*d,h=Math.cos(c),x=Math.sin(c);this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{...this.player.pos},velocity:{x:h*e.speed*this.player.stats.speed,y:x*e.speed*this.player.stats.speed},damage:e.damage*this.player.stats.might,duration:120,pierce:3,radius:8*this.player.stats.area,color:b.umbralBarrage,markedForDeletion:!1,weaponId:e.id,behavior:"STRAIGHT",knockback:8})}}fireObsidian(e,s){const l=(this.player.facingRight?3:-3)+s*4;this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{x:this.player.pos.x,y:this.player.pos.y-20},velocity:{x:l*this.player.stats.speed,y:-9*this.player.stats.speed},damage:e.damage*this.player.stats.might*1.5,duration:120,pierce:999,radius:10*this.player.stats.area,color:b.obsidianShard,markedForDeletion:!1,weaponId:e.id,behavior:"ARC",gravity:.25,knockback:10})}spawnShield(e,s,i){const l=Math.PI*2*s/i,r=80*this.player.stats.area;this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{x:this.player.pos.x,y:this.player.pos.y},velocity:{x:0,y:0},damage:e.damage*this.player.stats.might,duration:e.duration,pierce:999,radius:8,color:b.spectralShield,markedForDeletion:!1,weaponId:e.id,behavior:"ORBIT",orbitAngle:l,orbitDistance:r,orbitSpeed:.05*this.player.stats.speed,knockback:15})}pulseCorrosive(e){const s=e.area*50*this.player.stats.area;this.enemies.forEach(i=>{if(Math.hypot(i.pos.x-this.player.pos.x,i.pos.y-this.player.pos.y)<s+i.radius){this.applyDamage(i,e.damage*this.player.stats.might,e.id);const r=1,n=Math.atan2(i.pos.y-this.player.pos.y,i.pos.x-this.player.pos.x);i.pos.x+=Math.cos(n)*r,i.pos.y+=Math.sin(n)*r,i.hp<=0&&!i.markedForDeletion&&this.handleEnemyDeath(i)}})}strikeThunder(e,s){const i=this.enemies.filter(l=>{const r=Math.abs(l.pos.x-this.player.pos.x),n=Math.abs(l.pos.y-this.player.pos.y);return r<window.innerWidth/2&&n<window.innerHeight/2});if(i.length!==0)for(let l=0;l<s&&i.length!==0;l++){const r=Math.floor(Math.random()*i.length),n=i.splice(r,1)[0];this.applyDamage(n,e.damage*this.player.stats.might,e.id),n.hp<=0&&!n.markedForDeletion&&this.handleEnemyDeath(n),this.particles.push({id:Math.random().toString(),type:g.VISUAL_PARTICLE,pos:{x:n.pos.x,y:n.pos.y-300},targetPos:{x:n.pos.x,y:n.pos.y},life:15,maxLife:15,renderType:"LIGHTNING",width:3*this.player.stats.area,radius:0,color:b.thunderStrike,markedForDeletion:!1})}}firePlasma(e){const s=this.player.facingRight?1:-1;this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{x:this.player.pos.x,y:this.player.pos.y},velocity:{x:s*e.speed*this.player.stats.speed,y:0},damage:e.damage*this.player.stats.might,duration:e.duration,pierce:999,radius:20*this.player.stats.area,color:b.plasmaCutter,markedForDeletion:!1,weaponId:e.id,behavior:"STRAIGHT",knockback:12})}fireBloodSiphon(e,s){const i=this.getNearestEnemy();if(i)for(let l=0;l<s;l++)setTimeout(()=>{i&&!i.markedForDeletion&&this.spawnProjectile(i,e,b.bloodSiphon,1,"STRAIGHT")},l*150)}fireFrostNova(e){const s=150*e.area*this.player.stats.area;this.particles.push({id:Math.random().toString(),type:g.VISUAL_PARTICLE,pos:{...this.player.pos},life:20,maxLife:20,renderType:"FROST_NOVA",radius:s,color:b.frostNova,markedForDeletion:!1}),this.enemies.forEach(i=>{if(Math.hypot(i.pos.x-this.player.pos.x,i.pos.y-this.player.pos.y)<s){this.applyDamage(i,e.damage*this.player.stats.might,e.id);const r=Math.atan2(i.pos.y-this.player.pos.y,i.pos.x-this.player.pos.x);i.pos.x+=Math.cos(r)*30,i.pos.y+=Math.sin(r)*30,i.hp<=0&&!i.markedForDeletion&&this.handleEnemyDeath(i)}})}spawnWhirlingAxe(e,s,i){const l=Math.PI*2*s/i;this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{...this.player.pos},velocity:{x:0,y:0},damage:e.damage*this.player.stats.might,duration:e.duration,pierce:999,radius:12*this.player.stats.area,color:b.whirlingAxe,markedForDeletion:!1,weaponId:e.id,behavior:"ORBIT",orbitAngle:l,orbitDistance:10,orbitGrowth:4,orbitSpeed:.15*this.player.stats.speed,knockback:10})}fireFlameBreath(e,s){const i=this.player.facingRight?0:Math.PI;for(let l=0;l<s;l++)setTimeout(()=>{const r=(Math.random()-.5)*.5,n=i+r,d=Math.cos(n),t=Math.sin(n);this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{...this.player.pos},velocity:{x:d*e.speed*this.player.stats.speed,y:t*e.speed*this.player.stats.speed},damage:e.damage*this.player.stats.might,duration:e.duration,pierce:999,radius:8*this.player.stats.area,color:b.flameBreath,markedForDeletion:!1,weaponId:e.id,behavior:"STRAIGHT",knockback:2})},l*50)}spawnVoidTrap(e){this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{...this.player.pos},velocity:{x:0,y:0},damage:e.damage*this.player.stats.might,duration:e.duration,pierce:999,radius:60*this.player.stats.area,color:b.voidTrap,markedForDeletion:!1,weaponId:e.id,behavior:"STATIONARY",knockback:0})}fireRicochetBlade(e){const s=this.getNearestEnemy();if(!s)return;const i=s.pos.x-this.player.pos.x,l=s.pos.y-this.player.pos.y,r=Math.hypot(i,l);this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{...this.player.pos},velocity:{x:i/r*e.speed*this.player.stats.speed,y:l/r*e.speed*this.player.stats.speed},damage:e.damage*this.player.stats.might,duration:180,pierce:3+Math.floor(e.level/2),radius:6*this.player.stats.area,color:b.ricochetBlade,markedForDeletion:!1,weaponId:e.id,behavior:"STRAIGHT",knockback:4,lastHitId:"player"})}fireVortexOrb(e){const s=this.getNearestEnemy();let i=1,l=0;if(s){const r=s.pos.x-this.player.pos.x,n=s.pos.y-this.player.pos.y,d=Math.hypot(r,n);i=r/d,l=n/d}else i=this.player.facingRight?1:-1;this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{...this.player.pos},velocity:{x:i*e.speed,y:l*e.speed},damage:e.damage*this.player.stats.might,duration:e.duration,pierce:999,radius:10,color:b.vortexOrb,markedForDeletion:!1,weaponId:e.id,behavior:"STRAIGHT",knockback:0,pullRadius:120*e.area*this.player.stats.area,pullForce:1.5})}fireInfernoGrenade(e){const i=this.player.facingRight?4:-4;this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{x:this.player.pos.x,y:this.player.pos.y-15},velocity:{x:i*this.player.stats.speed,y:-6*this.player.stats.speed},damage:e.damage*this.player.stats.might,duration:e.duration,pierce:1,radius:8,color:b.infernoGrenade,markedForDeletion:!1,weaponId:e.id,behavior:"ARC",gravity:.2,knockback:0,onHitEffect:"EXPLODE"})}firePhantomDaggers(e,s){const i=this.player.facingRight?Math.PI:0;for(let l=0;l<s;l++){const r=(Math.random()-.5)*.4,n=i+r,d=Math.cos(n),t=Math.sin(n);this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{...this.player.pos},velocity:{x:d*e.speed*this.player.stats.speed,y:t*e.speed*this.player.stats.speed},damage:e.damage*this.player.stats.might,duration:e.duration,pierce:2,radius:4,color:b.phantomDaggers,markedForDeletion:!1,weaponId:e.id,behavior:"STRAIGHT",knockback:4})}}triggerExplosion(e){this.particles.push({id:Math.random().toString(),type:g.VISUAL_PARTICLE,pos:{...e.pos},life:20,maxLife:20,renderType:"EXPLOSION",radius:60*this.player.stats.area,color:"#ef4444",markedForDeletion:!1});const s=60*this.player.stats.area;this.enemies.forEach(i=>{if(Math.hypot(i.pos.x-e.pos.x,i.pos.y-e.pos.y)<s){this.applyDamage(i,e.damage,e.weaponId);const r=Math.atan2(i.pos.y-e.pos.y,i.pos.x-e.pos.x);i.pos.x+=Math.cos(r)*15,i.pos.y+=Math.sin(r)*15,i.hp<=0&&!i.markedForDeletion&&this.handleEnemyDeath(i)}})}genericFire(e,s,i,l){const r=this.getNearestEnemy();if(r)for(let n=0;n<s;n++)setTimeout(()=>{r&&!r.markedForDeletion&&this.spawnProjectile(r,e,l,1,i)},n*100)}getNearestEnemy(){let e=null,s=600;for(const i of this.enemies){const l=Math.hypot(i.pos.x-this.player.pos.x,i.pos.y-this.player.pos.y);l<s&&(s=l,e=i)}return e}spawnProjectile(e,s,i,l,r){const n=e.pos.x-this.player.pos.x,d=e.pos.y-this.player.pos.y,t=Math.sqrt(n*n+d*d);this.projectiles.push({id:Math.random().toString(36),type:g.PROJECTILE,pos:{...this.player.pos},velocity:{x:n/t*s.speed*this.player.stats.speed,y:d/t*s.speed*this.player.stats.speed},damage:s.damage*this.player.stats.might,duration:120,pierce:l,radius:6*this.player.stats.area,color:i,markedForDeletion:!1,weaponId:s.id,behavior:r,knockback:5})}handleEnemyDeath(e){e.markedForDeletion=!0,this.spawnBloodParticles(e.pos,e.color),e.enemyType===S.BOSS?(this.bossKilled=!0,this.chests.push({id:Math.random().toString(),type:g.CHEST,pos:{...e.pos},radius:20,color:"#d4af37",markedForDeletion:!1,isRare:Math.random()<.2}),this.enemies.forEach(s=>{s.enemyType!==S.BOSS&&(s.hp=0)})):this.gems.push({id:Math.random().toString(),type:g.GEM,pos:{...e.pos},value:e.xpValue,radius:4,color:b.gem,markedForDeletion:!1}),this.score++}spawnImpactParticles(e,s){for(let l=0;l<4;l++){const r=Math.random()*Math.PI*2,n=Math.random()*2+1;this.particles.push({id:Math.random().toString(),type:g.VISUAL_PARTICLE,pos:{...e},life:15,maxLife:15,renderType:"SPARK",radius:Math.random()*2+1,color:s,markedForDeletion:!1,velocity:{x:Math.cos(r)*n,y:Math.sin(r)*n}})}}spawnBloodParticles(e,s){for(let l=0;l<6;l++){const r=Math.random()*Math.PI*2,n=Math.random()*3+1;this.particles.push({id:Math.random().toString(),type:g.VISUAL_PARTICLE,pos:{...e},life:30,maxLife:30,renderType:"BLOOD",radius:Math.random()*2+2,color:s,markedForDeletion:!1,velocity:{x:Math.cos(r)*n,y:Math.sin(r)*n},gravity:.1})}}spawnCritParticles(e){for(let i=0;i<5;i++){const l=Math.PI*2*i/5,r=4;this.particles.push({id:Math.random().toString(),type:g.VISUAL_PARTICLE,pos:{...e},life:20,maxLife:20,renderType:"CRIT",radius:4,color:"#fbbf24",markedForDeletion:!1,velocity:{x:Math.cos(l)*r,y:Math.sin(l)*r}})}}checkCollisions(){this.projectiles.forEach(e=>{this.destructibles.forEach(s=>{Math.hypot(e.pos.x-s.pos.x,e.pos.y-s.pos.y)<s.radius+e.radius&&(s.hp-=e.damage,s.hp<=0&&!s.markedForDeletion&&(s.markedForDeletion=!0,this.spawnPickup(s.pos)),e.markedForDeletion=!0)}),this.enemies.forEach(s=>{if(e.markedForDeletion||s.markedForDeletion)return;let i=!1;if(e.weaponId==="plasma_cutter"){const l=e.radius*2,r=e.radius*4;Math.abs(e.pos.x-s.pos.x)<l&&Math.abs(e.pos.y-s.pos.y)<r&&(i=!0)}else if(e.weaponId==="void_trap"){if(Math.hypot(e.pos.x-s.pos.x,e.pos.y-s.pos.y)<e.radius+s.radius){this.frameCount%20===0&&(this.applyDamage(s,e.damage,e.weaponId),s.hp<=0&&this.handleEnemyDeath(s));return}}else if(Math.hypot(e.pos.x-s.pos.x,e.pos.y-s.pos.y)<e.radius+s.radius){if(e.weaponId==="ricochet_blade"&&e.lastHitId===s.id)return;i=!0}if(i){if(e.onHitEffect==="EXPLODE"){this.triggerExplosion(e),e.markedForDeletion=!0;return}if(this.spawnImpactParticles(s.pos,e.color),this.applyDamage(s,e.damage,e.weaponId),e.weaponId==="blood_siphon"&&this.player.hp<this.player.maxHp){const r=1*this.player.stats.might;this.player.hp=Math.min(this.player.maxHp,this.player.hp+r),this.addDamageText(this.player.pos,r,!1,"HEAL")}if(this.player.stats.lifesteal>0&&this.player.hp<this.player.maxHp){const r=e.damage*this.player.stats.lifesteal;this.player.hp=Math.min(this.player.maxHp,this.player.hp+r),(r>=1||Math.random()<.1)&&this.addDamageText(this.player.pos,r,!1,"HEAL")}const l=Math.atan2(s.pos.y-e.pos.y,s.pos.x-e.pos.x);if(s.pos.x+=Math.cos(l)*e.knockback,s.pos.y+=Math.sin(l)*e.knockback,e.weaponId==="ricochet_blade")if(e.lastHitId=s.id,e.pierce>0){e.pierce--;let r=null,n=500;for(const d of this.enemies)if(d!==s&&!d.markedForDeletion){const t=Math.hypot(d.pos.x-e.pos.x,d.pos.y-e.pos.y);t<n&&(n=t,r=d)}if(r){const d=r.pos.x-e.pos.x,t=r.pos.y-e.pos.y,c=Math.hypot(d,t),h=Math.hypot(e.velocity.x,e.velocity.y);e.velocity={x:d/c*h,y:t/c*h}}else{const d=Math.random()*Math.PI*2,t=Math.hypot(e.velocity.x,e.velocity.y);e.velocity={x:Math.cos(d)*t,y:Math.sin(d)*t}}}else e.markedForDeletion=!0;else e.pierce<100&&(e.pierce--,e.pierce<=0&&(e.markedForDeletion=!0));s.hp<=0&&!s.markedForDeletion&&this.handleEnemyDeath(s)}})}),this.frameCount%10===0&&this.enemies.forEach(e=>{Math.hypot(e.pos.x-this.player.pos.x,e.pos.y-this.player.pos.y)<e.radius+this.player.radius&&(this.player.hp-=e.damage,this.addDamageText(this.player.pos,e.damage,!1,"PLAYER_DAMAGE"),this.player.hp<=0&&(this.isGameOver=!0,this.onGameOver({kills:this.score,time:Math.floor(this.frameCount/60),level:this.player.level,bossKilled:this.bossKilled,gemsCollected:this.gemsCollected,goldCollected:this.goldCollected})))})}applyDamage(e,s,i){const l=Math.random()<this.player.stats.luck;let r=l?s*2:s;r=Math.max(1,Math.floor(r)),l&&this.spawnCritParticles(e.pos),e.hp-=r;const n=this.damageTexts.find(d=>d.id===e.lastDamageTextId&&!d.markedForDeletion);if(n&&n.life>.4)n.value+=r,n.text=Math.floor(n.value).toString(),n.life=.8,n.pos.y=e.pos.y-e.radius-15,n.pos.x=e.pos.x+(Math.random()*10-5),l&&(n.isCrit=!0);else{const d=this.addDamageText(e.pos,r,l,"DAMAGE");d&&(e.lastDamageTextId=d.id)}}spawnPickup(e){const s=Math.random();let i=T.GOLD,l=10,r=b.gold;s<.1?(i=T.CHICKEN,l=30,r="#e11d48"):s<.15?(i=T.VACUUM,l=0,r="#06b6d4"):s<.16?(i=T.ROSARY,l=0,r="#f8fafc"):(i=T.GOLD,l=10,r=b.gold),this.pickups.push({id:Math.random().toString(),type:g.PICKUP,pickupType:i,pos:{...e},radius:10,value:l,color:r,markedForDeletion:!1})}addDamageText(e,s,i,l="DAMAGE"){if(s<.5&&l!=="HEAL"||s<=0)return null;let r="#fff";l==="PLAYER_DAMAGE"&&(r="#ef4444"),l==="HEAL"&&(r="#22c55e");const n={id:Math.random().toString(),type:g.TEXT_PARTICLE,pos:{x:e.x,y:e.y-10},text:Math.round(s).toString(),value:s,velocity:{x:Math.random()-.5,y:-1},life:.8,opacity:1,radius:0,color:r,markedForDeletion:!1,isCrit:i};return this.damageTexts.push(n),n}checkLevelUp(){this.player.xp>=this.player.nextLevelXp&&(this.player.level++,this.player.xp-=this.player.nextLevelXp,this.player.nextLevelXp=Math.floor(this.player.nextLevelXp*1.3),this.isPaused=!0,this.onLevelUp(this.generateUpgrades()))}generateUpgrades(){const e=[],s=[],i=L(),l=this.player.weapons.find(c=>c.id==="shadow_bolt");l&&l.level>=l.maxLevel&&s.push({id:"evolve_shadow_bolt",name:"Umbral Barrage",description:"EVOLUTION: Unleash the true power of the void. Replaces Shadow Bolt.",rarity:"legendary",type:"WEAPON",apply:c=>{c.weapons=c.weapons.filter(h=>h.id!=="shadow_bolt"),c.weapons.push(this.getWeaponConfig("umbral_barrage"))}});const r=c=>{const h=R[c],x=this.player.weapons.find(p=>p.id===c);if(x){if(x.level>=x.maxLevel)return;e.push({id:`upgrade_${c}`,name:`${h.name} ${x.level+1}`,description:`Level ${x.level+1}: Increases power/amount.`,rarity:"common",type:"WEAPON",apply:p=>{const u=p.weapons.find(m=>m.id===c);u.level++,u.level%2===0&&(u.damage*=1.2),u.level%3===0&&(u.amount+=1),u.area*=1.1}})}else{if(this.player.weapons.length>=6||!h.unlockCondition(i))return;e.push({id:`new_${c}`,name:h.name,description:h.description,rarity:"rare",type:"WEAPON",apply:p=>{p.weapons.push(this.getWeaponConfig(c))}})}};Object.keys(R).forEach(c=>r(c)),Object.entries($e).forEach(([c,h])=>{const x=this.player.passives.find(p=>p.id===c);if(x){if(x.level>=x.maxLevel)return;e.push({id:`upgrade_${c}`,name:`${h.name} ${x.level+1}`,description:`${h.description} (Lvl ${x.level+1})`,rarity:"common",type:"PASSIVE",apply:p=>{const u=p.passives.find(m=>m.id===c);u.level++,p.stats[h.stat]+=h.increase}})}else{if(this.player.passives.length>=6)return;e.push({id:`new_${c}`,name:h.name,description:h.description,rarity:"common",type:"PASSIVE",apply:p=>{p.passives.push({id:c,name:h.name,description:h.description,level:1,maxLevel:h.maxLevel,icon:h.icon}),p.stats[h.stat]+=h.increase}})}}),e.length===0&&s.length===0&&e.push({id:"heal_fallback",name:"Crimson Vial",description:"Heal 30 HP.",rarity:"common",type:"PASSIVE",apply:c=>{c.hp=Math.min(c.maxHp,c.hp+30)}});const n=e.sort(()=>.5-Math.random()),d=[...s],t=3-d.length;return t>0&&d.push(...n.slice(0,t)),d}cleanup(){this.enemies=this.enemies.filter(e=>!e.markedForDeletion),this.projectiles=this.projectiles.filter(e=>!e.markedForDeletion),this.gems=this.gems.filter(e=>!e.markedForDeletion),this.chests=this.chests.filter(e=>!e.markedForDeletion),this.damageTexts=this.damageTexts.filter(e=>!e.markedForDeletion),this.particles=this.particles.filter(e=>!e.markedForDeletion),this.destructibles=this.destructibles.filter(e=>!e.markedForDeletion),this.pickups=this.pickups.filter(e=>!e.markedForDeletion)}drawPlayer(){const e=this.ctx,s=this.player,i=this.frameCount;e.save(),e.translate(s.pos.x,s.pos.y),e.fillStyle="rgba(0,0,0,0.4)",e.beginPath(),e.ellipse(0,s.radius+4,s.radius,s.radius*.3,0,0,Math.PI*2),e.fill();const l=s.facingRight?1:-1;e.scale(l,1);const r=["kael","vex","seraphina","isolde"].includes(s.characterId),n=r?Math.sin(i*.05)*3:0,d=r?0:Math.sin(i*.1)*.03;if(e.translate(0,n),r||e.scale(1,1-d),s.characterId==="grom")e.fillStyle="#334155",e.fillRect(-10,-12,20,24),e.fillStyle="#475569",e.beginPath(),e.arc(0,-12,11,Math.PI,0),e.lineTo(11,-8),e.lineTo(-11,-8),e.fill(),e.fillStyle="#0ea5e9",e.shadowColor="#0ea5e9",e.shadowBlur=5,e.fillRect(2,-14,8,3),e.shadowBlur=0,e.fillStyle="#1e293b",e.beginPath(),e.moveTo(-10,-10),e.lineTo(-16,-14),e.lineTo(-10,-4),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(16,-14),e.lineTo(10,-4),e.fill();else if(s.characterId==="lyra"){e.fillStyle="#ea580c",e.beginPath(),e.moveTo(-8,-10),e.lineTo(8,-10),e.lineTo(12,12),e.lineTo(-12,12),e.fill(),e.fillStyle="#fdba74",e.beginPath(),e.arc(0,-12,9,0,Math.PI*2),e.fill(),e.fillStyle="#f97316";const t=Math.sin(i*.2)*2;e.beginPath(),e.moveTo(-9,-14),e.quadraticCurveTo(0,-25+t,9,-14),e.lineTo(9,-10),e.lineTo(-9,-10),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(4,-11,2,0,Math.PI*2),e.fill()}else if(s.characterId==="kael"){e.fillStyle="#1e3a8a",e.beginPath(),e.moveTo(0,-15),e.lineTo(10,10),e.lineTo(-10,10),e.fill(),e.fillStyle="#172554",e.beginPath(),e.arc(0,-12,10,0,Math.PI*2),e.fill(),e.fillStyle="#60a5fa",e.shadowColor="#60a5fa",e.shadowBlur=10,e.beginPath(),e.arc(3,-11,2,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.strokeStyle="#93c5fd",e.lineWidth=1;const t=i*.05;e.save(),e.translate(0,-25),e.rotate(t),e.strokeRect(-4,-4,8,8),e.restore()}else if(s.characterId==="vex")e.fillStyle="#581c87",e.beginPath(),e.arc(0,0,12+Math.sin(i*.2),0,Math.PI*2),e.fill(),e.fillStyle="#a855f7",e.shadowColor="#a855f7",e.shadowBlur=15,e.beginPath(),e.arc(0,0,6,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.fillStyle="#fff",e.fillRect(2,-4,4,2),e.fillRect(6,-2,2,2);else if(s.characterId==="seraphina"){e.fillStyle="#db2777",e.beginPath(),e.ellipse(0,0,8,14,0,0,Math.PI*2),e.fill(),e.fillStyle="#fce7f3",e.beginPath(),e.arc(0,-14,8,0,Math.PI*2),e.fill(),e.strokeStyle="#f472b6",e.lineWidth=4,e.lineCap="round",e.beginPath(),e.moveTo(-4,-10);const t=Math.sin(i*.2)*5;e.quadraticCurveTo(-15,-10,-25,-5+t),e.stroke(),e.fillStyle="#000",e.beginPath(),e.arc(4,-14,1.5,0,Math.PI*2),e.fill()}else s.characterId==="darius"?(e.fillStyle="#7f1d1d",e.fillRect(-9,-10,18,20),e.fillStyle="#000",e.beginPath(),e.moveTo(-9,-10),e.lineTo(-14,-18),e.lineTo(-5,-10),e.fill(),e.beginPath(),e.moveTo(9,-10),e.lineTo(14,-18),e.lineTo(5,-10),e.fill(),e.fillStyle="#991b1b",e.beginPath(),e.arc(0,-12,9,0,Math.PI*2),e.fill(),e.fillStyle="#fca5a5",e.shadowColor="#ef4444",e.shadowBlur=5,e.beginPath(),e.arc(3,-11,2,0,Math.PI*2),e.fill(),e.shadowBlur=0):s.characterId==="isolde"?(e.fillStyle="#0891b2",e.beginPath(),e.moveTo(0,-12),e.lineTo(10,12),e.lineTo(-10,12),e.fill(),e.fillStyle="#cffafe",e.beginPath(),e.arc(0,-12,8,0,Math.PI*2),e.fill(),e.fillStyle="#a5f3fc",e.beginPath(),e.moveTo(-8,-14),e.lineTo(-5,-20),e.lineTo(0,-16),e.lineTo(5,-20),e.lineTo(8,-14),e.fill(),e.fillStyle="#164e63",e.beginPath(),e.arc(3,-11,1.5,0,Math.PI*2),e.fill()):s.characterId==="grimwald"?(e.fillStyle="#78350f",e.fillRect(-10,-10,20,20),e.fillStyle="#451a03",e.beginPath(),e.arc(0,-12,10,0,Math.PI*2),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(0,-10,6,0,Math.PI,!1),e.fill()):s.characterId==="ignis"?(e.fillStyle="#b91c1c",e.beginPath(),e.rect(-9,-10,18,20),e.fill(),e.fillStyle="#fecaca",e.beginPath(),e.arc(0,-12,9,0,Math.PI*2),e.fill(),e.fillStyle="#333",e.beginPath(),e.arc(2,-13,4,0,Math.PI*2),e.arc(7,-13,4,0,Math.PI*2),e.fill(),e.fillStyle="#4ade80",e.shadowColor="#4ade80",e.shadowBlur=5,e.beginPath(),e.arc(2,-13,2,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(7,-13,2,0,Math.PI*2),e.fill(),e.shadowBlur=0):s.characterId==="elara"?(e.fillStyle="#334155",e.beginPath(),e.ellipse(0,2,8,12,0,0,Math.PI*2),e.fill(),e.fillStyle="#f1f5f9",e.beginPath(),e.arc(0,-10,8,0,Math.PI*2),e.fill(),e.fillStyle="#0f172a",e.beginPath(),e.moveTo(-8,-8),e.quadraticCurveTo(0,-4,8,-8),e.lineTo(8,-2),e.quadraticCurveTo(0,4,-8,-2),e.fill(),e.strokeStyle="#ef4444",e.lineWidth=2,e.beginPath(),e.moveTo(-6,-8),e.lineTo(-12,-4+Math.sin(i*.3)*3),e.stroke(),e.fillStyle="#334155",e.beginPath(),e.arc(3,-12,1.5,0,Math.PI*2),e.fill()):(e.fillStyle=s.color,e.beginPath(),e.arc(0,0,s.radius,0,Math.PI*2),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(4,-3,3.5,0,Math.PI*2),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(5.5,-3,1.5,0,Math.PI*2),e.fill());e.restore()}draw(){const e=window.devicePixelRatio||1;this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore();const s=window.innerWidth/2-this.player.pos.x,i=window.innerHeight/2-this.player.pos.y;if(this.bgPattern){this.ctx.save(),this.ctx.translate(s,i),this.ctx.fillStyle=this.bgPattern;const t=this.player.pos.x-window.innerWidth/2,c=this.player.pos.y-window.innerHeight/2;this.ctx.fillRect(t-100,c-100,window.innerWidth+200,window.innerHeight+200),this.ctx.restore()}else this.ctx.fillStyle=b.background,this.ctx.fillRect(0,0,window.innerWidth,window.innerHeight);this.ctx.save(),this.ctx.translate(s,i),this.destructibles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.fillRect(t.pos.x-4,t.pos.y,8,20),this.ctx.arc(t.pos.x,t.pos.y,8,0,Math.PI,!1),this.ctx.fill(),this.ctx.fillStyle="#f59e0b",this.ctx.shadowColor="#f59e0b",this.ctx.shadowBlur=15,this.ctx.beginPath(),this.ctx.arc(t.pos.x,t.pos.y-5,6+Math.sin(this.frameCount*.2)*2,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0}),this.pickups.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.save(),this.ctx.translate(t.pos.x,t.pos.y+Math.sin(this.frameCount*.1)*3),t.pickupType===T.GOLD?(this.ctx.shadowColor=b.gold,this.ctx.shadowBlur=5,this.ctx.beginPath(),this.ctx.arc(0,0,6,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#fff",this.ctx.font="8px Arial",this.ctx.textAlign="center",this.ctx.fillText("$",0,3),this.ctx.shadowBlur=0):t.pickupType===T.CHICKEN?(this.ctx.fillRect(-6,-4,12,8),this.ctx.fillStyle="#fff",this.ctx.fillRect(4,-4,2,8)):t.pickupType===T.VACUUM?(this.ctx.shadowColor="#06b6d4",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(0,0,8,0,Math.PI*2),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.fillStyle=t.color,this.ctx.fill(),this.ctx.shadowBlur=0):(this.ctx.beginPath(),this.ctx.arc(0,0,6,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#94a3b8",this.ctx.beginPath(),this.ctx.arc(0,-10,2,0,Math.PI*2),this.ctx.stroke()),this.ctx.restore()}),this.gems.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.moveTo(t.pos.x,t.pos.y-t.radius),this.ctx.lineTo(t.pos.x+t.radius,t.pos.y),this.ctx.lineTo(t.pos.x,t.pos.y+t.radius),this.ctx.lineTo(t.pos.x-t.radius,t.pos.y),this.ctx.fill()}),this.chests.forEach(t=>{const c=t.pos.x,h=t.pos.y,x=30,p=20;this.ctx.save(),this.ctx.translate(c,h),this.ctx.shadowColor="#eab308",this.ctx.shadowBlur=15+Math.sin(this.frameCount*.1)*5,this.ctx.fillStyle="#92400e",this.ctx.fillRect(-x/2,-p/2,x,p),this.ctx.fillStyle="#fbbf24",this.ctx.fillRect(-x/2,-p/4,x,p/4),this.ctx.fillRect(-4,-p/2,8,p),this.ctx.fillStyle="#000",this.ctx.fillRect(-2,-2,4,4),this.ctx.restore()});const l=this.player.weapons.find(t=>t.id==="corrosive_aura");if(l){const t=l.area*50*this.player.stats.area,c=this.ctx.createRadialGradient(this.player.pos.x,this.player.pos.y,t*.2,this.player.pos.x,this.player.pos.y,t);c.addColorStop(0,"rgba(132, 204, 22, 0)"),c.addColorStop(.8,"rgba(132, 204, 22, 0.2)"),c.addColorStop(1,"rgba(132, 204, 22, 0)"),this.ctx.fillStyle=c,this.ctx.beginPath(),this.ctx.arc(this.player.pos.x,this.player.pos.y,t,0,Math.PI*2),this.ctx.fill(),this.ctx.save(),this.ctx.translate(this.player.pos.x,this.player.pos.y),this.ctx.rotate(this.frameCount*.02),this.ctx.strokeStyle="rgba(163, 230, 53, 0.3)",this.ctx.lineWidth=2,this.ctx.setLineDash([10,20]),this.ctx.beginPath(),this.ctx.arc(0,0,t*.7,0,Math.PI*2),this.ctx.stroke(),this.ctx.rotate(this.frameCount*.03),this.ctx.beginPath(),this.ctx.arc(0,0,t*.9,0,Math.PI*2),this.ctx.stroke(),this.ctx.restore()}this.enemies.forEach(t=>{if(this.ctx.save(),this.ctx.translate(t.pos.x,t.pos.y),this.player.pos.x<t.pos.x&&this.ctx.scale(-1,1),this.ctx.globalAlpha=t.opacity||1,this.ctx.shadowBlur=0,t.enemyType===S.BOSS){this.ctx.shadowBlur=20,this.ctx.shadowColor=t.color;const c=Math.sin(this.frameCount*.1)*3;this.ctx.fillStyle="#2e1065",this.ctx.beginPath(),this.ctx.arc(0,0,t.radius+c,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#a855f7",this.ctx.lineWidth=3,this.ctx.beginPath();const h=10;for(let x=0;x<=h;x++){const p=Math.PI*2*x/h+this.frameCount*.02,u=t.radius*.8,m=t.radius*1.2,y=Math.cos(p),M=Math.sin(p);x===0&&this.ctx.moveTo(y*u,M*u),this.ctx.lineTo(y*m,M*m),this.ctx.lineTo(Math.cos(p+.1)*u,Math.sin(p+.1)*u)}this.ctx.stroke(),this.ctx.fillStyle="#000",this.ctx.beginPath(),this.ctx.arc(0,0,t.radius*.6,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ef4444",this.ctx.shadowColor="#ef4444",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.moveTo(-10,-5),this.ctx.lineTo(-5,0),this.ctx.lineTo(-12,2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(10,-5),this.ctx.lineTo(5,0),this.ctx.lineTo(12,2),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.save(),this.player.pos.x<t.pos.x&&this.ctx.scale(-1,1),this.ctx.fillStyle="black",this.ctx.fillRect(-30,-t.radius-20,60,6),this.ctx.fillStyle="#dc2626",this.ctx.fillRect(-29,-t.radius-19,58*(t.hp/t.maxHp),4),this.ctx.restore()}else if(t.enemyType===S.BAT){const c=Math.sin(this.frameCount*.4+t.animationOffset)*10;this.ctx.fillStyle="#1e293b",this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.quadraticCurveTo(10,-10+c,15,-5+c/2),this.ctx.quadraticCurveTo(8,5,0,2),this.ctx.moveTo(0,0),this.ctx.quadraticCurveTo(-10,-10+c,-15,-5+c/2),this.ctx.quadraticCurveTo(-8,5,0,2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(0,0,t.radius*.6,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ef4444",this.ctx.beginPath(),this.ctx.arc(2,-2,1.5,0,Math.PI*2),this.ctx.arc(5,-2,1.5,0,Math.PI*2),this.ctx.fill()}else if(t.enemyType===S.ZOMBIE){const c=Math.sin(this.frameCount*.15+t.animationOffset)*.1;this.ctx.rotate(c),this.ctx.fillStyle=t.visualVariant===1?"#365314":"#15803d",this.ctx.beginPath(),this.ctx.roundRect(-8,-6,16,14,4),this.ctx.fill(),this.ctx.fillStyle="#86efac",this.ctx.beginPath(),this.ctx.arc(0,-8,7,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#86efac",this.ctx.beginPath(),this.ctx.roundRect(4,-4,10,3,1.5),this.ctx.roundRect(4,1,10,3,1.5),this.ctx.fill(),this.ctx.fillStyle="#14532d",this.ctx.beginPath(),this.ctx.arc(2,-9,2,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#fca5a5",t.visualVariant===2&&(this.ctx.beginPath(),this.ctx.arc(-3,-11,2.5,0,Math.PI*2),this.ctx.fill())}else if(t.enemyType===S.SKELETON){const c=Math.abs(Math.sin(this.frameCount*.15+t.animationOffset))*2;this.ctx.translate(0,-c),this.ctx.strokeStyle="#e2e8f0",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(0,-4),this.ctx.lineTo(0,8),this.ctx.moveTo(-5,-2),this.ctx.lineTo(5,-2),this.ctx.moveTo(-4,2),this.ctx.lineTo(4,2),this.ctx.moveTo(-3,6),this.ctx.lineTo(3,6),this.ctx.stroke(),this.ctx.fillStyle="#f1f5f9",this.ctx.beginPath(),this.ctx.arc(0,-8,6.5,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#e2e8f0",this.ctx.fillRect(-3,-4,6,4),this.ctx.fillStyle="#0f172a",this.ctx.beginPath(),this.ctx.arc(2,-9,1.5,0,Math.PI*2),this.ctx.arc(-1,-9,1.5,0,Math.PI*2),this.ctx.fill(),this.ctx.save(),this.ctx.translate(8,2),this.ctx.rotate(-.5),this.ctx.fillStyle="#713f12",this.ctx.fillRect(0,-4,2,8),this.ctx.fillStyle="#94a3b8",this.ctx.beginPath(),this.ctx.moveTo(0,-4),this.ctx.quadraticCurveTo(8,-10,2,-14),this.ctx.lineTo(0,-4),this.ctx.fill(),this.ctx.restore()}else if(t.enemyType===S.GHOST){const c=Math.sin(this.frameCount*.05+t.animationOffset)*3;this.ctx.translate(0,c),this.ctx.shadowBlur=10,this.ctx.shadowColor="rgba(34, 211, 238, 0.5)",this.ctx.fillStyle="rgba(207, 250, 254, 0.8)",this.ctx.beginPath(),this.ctx.arc(0,-6,8,Math.PI,0);const h=this.frameCount*.15+t.animationOffset;this.ctx.lineTo(8,8),this.ctx.quadraticCurveTo(4,4+Math.sin(h)*3,0,10),this.ctx.quadraticCurveTo(-4,4+Math.cos(h)*3,-8,8),this.ctx.lineTo(-8,-6),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.fillStyle="#06b6d4",this.ctx.beginPath(),this.ctx.arc(3,-6,2,0,Math.PI*2),this.ctx.arc(-1,-6,2,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(1,-2,1.5,0,Math.PI*2),this.ctx.fill()}else this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,Math.PI*2),this.ctx.fill();this.ctx.restore()}),this.drawPlayer(),this.projectiles.forEach(t=>{if(this.ctx.save(),this.ctx.translate(t.pos.x,t.pos.y),isNaN(t.pos.x)||isNaN(t.pos.y)){this.ctx.restore();return}switch(t.weaponId){case"shadow_bolt":{const c=Math.atan2(t.velocity.y,t.velocity.x);this.ctx.rotate(c),this.ctx.shadowBlur=15,this.ctx.shadowColor=t.color,this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.ellipse(0,0,t.radius*1.5,t.radius*.8,0,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle=t.color,this.ctx.globalAlpha=.6,this.ctx.beginPath(),this.ctx.ellipse(-t.radius,0,t.radius*2,t.radius,0,0,Math.PI*2),this.ctx.fill();break}case"umbral_barrage":{const c=Math.atan2(t.velocity.y,t.velocity.x);this.ctx.rotate(c),this.ctx.shadowBlur=20,this.ctx.shadowColor="#a855f7",this.ctx.fillStyle="#000",this.ctx.beginPath(),this.ctx.arc(0,0,t.radius*.6,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle=t.color,this.ctx.globalAlpha=.8;for(let h=0;h<3;h++){const x=this.frameCount*.5+h*2;this.ctx.beginPath(),this.ctx.ellipse(-t.radius,Math.sin(x)*4,t.radius*2.5,t.radius*.5,0,0,Math.PI*2),this.ctx.fill()}break}case"obsidian_shard":{this.ctx.rotate(this.frameCount*.1),this.ctx.fillStyle="#334155",this.ctx.beginPath(),this.ctx.moveTo(-t.radius,-t.radius*.5),this.ctx.lineTo(0,-t.radius),this.ctx.lineTo(t.radius,-t.radius*.5),this.ctx.lineTo(t.radius*.5,t.radius),this.ctx.lineTo(-t.radius*.8,t.radius*.8),this.ctx.fill();break}case"spectral_shield":{this.ctx.rotate(this.frameCount*.1),this.ctx.globalCompositeOperation="lighter",this.ctx.fillStyle="#a5f3fc",this.ctx.shadowColor="#0891b2",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.moveTo(0,-t.radius),this.ctx.lineTo(t.radius*.6,0),this.ctx.lineTo(0,t.radius),this.ctx.lineTo(-t.radius*.6,0),this.ctx.fill();break}case"whirling_axe":{this.ctx.rotate(this.frameCount*.3),this.ctx.fillStyle="#94a3b8",this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.arc(0,0,t.radius,0,Math.PI/2),this.ctx.lineTo(0,0),this.ctx.arc(0,0,t.radius,Math.PI,Math.PI*1.5),this.ctx.fill(),this.ctx.fillStyle="#451a03",this.ctx.fillRect(-2,-t.radius,4,t.radius*2);break}case"plasma_cutter":{const c=Math.atan2(t.velocity.y,t.velocity.x);this.ctx.rotate(c),this.ctx.globalCompositeOperation="lighter",this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=15,this.ctx.fillRect(-t.radius,-t.radius/2,t.radius*4,t.radius),this.ctx.fillStyle="#fff",this.ctx.fillRect(-t.radius,-t.radius/4,t.radius*3,t.radius/2);break}case"flame_breath":case"inferno_grenade":{this.ctx.globalCompositeOperation="lighter",this.ctx.fillStyle="#ef4444",this.ctx.shadowColor="#f97316",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,Math.PI*2),this.ctx.fill();break}case"phantom_daggers":case"ricochet_blade":{const c=Math.atan2(t.velocity.y,t.velocity.x);this.ctx.rotate(c),this.ctx.fillStyle="#e2e8f0",this.ctx.shadowBlur=5,this.ctx.shadowColor="#fff",this.ctx.beginPath(),this.ctx.moveTo(t.radius,0),this.ctx.lineTo(-t.radius,t.radius/3),this.ctx.lineTo(-t.radius,-t.radius/3),this.ctx.fill();break}case"blood_siphon":{const c=Math.atan2(t.velocity.y,t.velocity.x)-Math.PI/2;this.ctx.rotate(c),this.ctx.fillStyle="#dc2626",this.ctx.beginPath(),this.ctx.moveTo(0,-t.radius),this.ctx.bezierCurveTo(t.radius,-t.radius/3,t.radius,t.radius,0,t.radius),this.ctx.bezierCurveTo(-t.radius,t.radius,-t.radius,-t.radius/3,0,-t.radius),this.ctx.fill(),this.ctx.fillStyle="#fff",this.ctx.globalAlpha=.6,this.ctx.beginPath(),this.ctx.ellipse(t.radius/3,-t.radius/3,t.radius/4,t.radius/6,Math.PI/4,0,Math.PI*2),this.ctx.fill();break}case"frost_nova":{this.ctx.strokeStyle="#a5f3fc",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,Math.PI*2),this.ctx.stroke();break}case"vortex_orb":{this.ctx.rotate(this.frameCount*-.2),this.ctx.fillStyle="#4c1d95",this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#8b5cf6",this.ctx.lineWidth=2;for(let c=0;c<4;c++)this.ctx.rotate(Math.PI/2),this.ctx.beginPath(),this.ctx.arc(t.radius,0,t.radius/2,0,Math.PI*2),this.ctx.stroke();break}case"void_trap":{this.ctx.shadowColor="#581c87",this.ctx.shadowBlur=10,this.ctx.strokeStyle="#a855f7",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="rgba(88, 28, 135, 0.3)",this.ctx.fill(),this.ctx.save(),this.ctx.rotate(this.frameCount*.05),this.ctx.beginPath(),this.ctx.moveTo(0,-t.radius+5),this.ctx.lineTo(t.radius-5,t.radius/2),this.ctx.lineTo(-t.radius+5,t.radius/2),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore();break}default:this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,Math.PI*2),this.ctx.fill()}this.ctx.restore()}),this.particles.forEach(t=>{this.ctx.save();const c=t.life/t.maxLife;if(this.ctx.globalCompositeOperation="lighter",t.renderType==="LIGHTNING"&&t.targetPos){this.ctx.beginPath(),this.ctx.strokeStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10,this.ctx.lineWidth=t.width||2,this.ctx.globalAlpha=c;const h=5;let x=t.pos.x,p=t.pos.y;this.ctx.moveTo(x,p);const u=(t.targetPos.x-t.pos.x)/h,m=(t.targetPos.y-t.pos.y)/h;for(let y=1;y<h;y++){x+=u,p+=m;const M=(Math.random()-.5)*20;this.ctx.lineTo(x+M,p+M)}this.ctx.lineTo(t.targetPos.x,t.targetPos.y),this.ctx.stroke()}else t.renderType==="EXPLOSION"?(this.ctx.shadowColor=t.color,this.ctx.shadowBlur=20,this.ctx.fillStyle=t.color,this.ctx.globalAlpha=c*.8,this.ctx.beginPath(),this.ctx.arc(t.pos.x,t.pos.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t.pos.x,t.pos.y,t.radius*(2-c),0,Math.PI*2),this.ctx.stroke()):t.renderType==="FROST_NOVA"?(this.ctx.shadowColor="#22d3ee",this.ctx.shadowBlur=15,this.ctx.strokeStyle="#67e8f9",this.ctx.lineWidth=4,this.ctx.globalAlpha=c,this.ctx.beginPath(),this.ctx.arc(t.pos.x,t.pos.y,t.radius*(1.5-c*.5),0,Math.PI*2),this.ctx.stroke()):t.renderType==="SPARK"?(this.ctx.fillStyle=t.color,this.ctx.globalAlpha=c,this.ctx.beginPath(),this.ctx.arc(t.pos.x,t.pos.y,t.radius*c,0,Math.PI*2),this.ctx.fill()):t.renderType==="BLOOD"?(this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle=t.color,this.ctx.globalAlpha=c*.8,this.ctx.beginPath(),this.ctx.arc(t.pos.x,t.pos.y,t.radius*c,0,Math.PI*2),this.ctx.fill()):t.renderType==="CRIT"&&(this.ctx.translate(t.pos.x,t.pos.y),this.ctx.rotate(this.frameCount*.2),this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10,this.ctx.globalAlpha=c,this.ctx.fillRect(-t.radius/2,-t.radius/2,t.radius,t.radius));this.ctx.restore()}),this.damageTexts.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=t.opacity;const c=t.life>.6?1.5:1;t.isCrit?(this.ctx.font="bold 32px Inter",this.ctx.fillStyle="#fbbf24",this.ctx.shadowColor="#d97706",this.ctx.shadowBlur=10):(this.ctx.font="bold 16px Inter",this.ctx.fillStyle=t.color,this.ctx.shadowBlur=0);const h=1+t.value/1e3,x=Math.min(2.5,h*c);this.ctx.translate(t.pos.x,t.pos.y),this.ctx.scale(x,x),this.ctx.fillText(t.text,0,0),t.isCrit&&t.life>.7&&(this.ctx.globalCompositeOperation="overlay",this.ctx.fillStyle="#fff",this.ctx.fillText(t.text,0,0)),this.ctx.restore()}),this.ctx.restore();const r=this.canvas.width/e,n=this.canvas.height/e,d=this.ctx.createRadialGradient(r/2,n/2,n/2,r/2,n/2,n);d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(1,"rgba(0,0,0,0.6)"),this.ctx.fillStyle=d,this.ctx.fillRect(0,0,r,n)}}const ie=(o,e=!1)=>{if(e)switch(o){case"spinach":return a.jsx(D,{size:18,className:"text-red-400"});case"empty_tome":return a.jsx(Te,{size:18,className:"text-yellow-400"});case"candelabrador":return a.jsx(le,{size:18,className:"text-cyan-400"});case"bracer":return a.jsx($,{size:18,className:"text-slate-300"});case"clover":return a.jsx(Pe,{size:18,className:"text-green-400"});case"wings":return a.jsx($,{size:18,className:"text-slate-200"});case"attractorb":return a.jsx(ke,{size:18,className:"text-blue-400"});case"pummarola":return a.jsx(oe,{size:18,className:"text-pink-400"});case"duplicator":return a.jsx(Se,{size:18,className:"text-indigo-400"});default:return a.jsx(G,{size:18,className:"text-white"})}switch(o){case"shadow_bolt":return a.jsx(O,{size:18,className:"text-indigo-400"});case"umbral_barrage":return a.jsx(O,{size:18,className:"text-purple-400 drop-shadow-[0_0_5px_rgba(168,85,247,0.8)]"});case"obsidian_shard":return a.jsx(D,{size:18,className:"text-slate-400"});case"spectral_shield":return a.jsx(Ce,{size:18,className:"text-cyan-400"});case"corrosive_aura":return a.jsx(G,{size:18,className:"text-lime-400"});case"thunder_strike":return a.jsx(O,{size:18,className:"text-fuchsia-400"});case"plasma_cutter":return a.jsx(Q,{size:18,className:"text-orange-400"});case"blood_siphon":return a.jsx(Ie,{size:18,className:"text-red-500"});case"frost_nova":return a.jsx(Ne,{size:18,className:"text-cyan-300"});case"whirling_axe":return a.jsx(Ee,{size:18,className:"text-yellow-600"});case"flame_breath":return a.jsx(je,{size:18,className:"text-orange-500"});case"void_trap":return a.jsx(G,{size:18,className:"text-purple-800"});case"ricochet_blade":return a.jsx(A,{size:18,className:"text-slate-300"});case"vortex_orb":return a.jsx(Q,{size:18,className:"text-violet-600"});case"inferno_grenade":return a.jsx(Me,{size:18,className:"text-red-600"});case"phantom_daggers":return a.jsx(A,{size:18,className:"text-slate-200"});default:return a.jsx(A,{size:18,className:"text-white"})}},Xe=({player:o,score:e,time:s,flavorText:i})=>{if(!o)return null;const l=Math.floor(s/60),r=s%60,n=`${l.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`,d=o.xp/o.nextLevelXp*100,t=o.hp/o.maxHp*100,c=6,h=o.weapons.slice(0,c),x=Array(Math.max(0,c-h.length)).fill(null),p=o.passives.slice(0,c),u=Array(Math.max(0,c-p.length)).fill(null);return a.jsxs("div",{className:"absolute inset-0 pointer-events-none p-4 flex flex-col justify-between",children:[a.jsxs("div",{className:"flex justify-between items-start w-full",children:[a.jsx("div",{className:"flex flex-col gap-2",children:a.jsxs("div",{className:"bg-slate-900/90 p-2 rounded-br-xl border-l-4 border-b border-r border-t-0 shadow-lg flex items-center gap-3 pr-6",style:{borderColor:o.color},children:[a.jsx("div",{className:"w-10 h-10 rounded border-2 border-slate-700 bg-slate-800 flex items-center justify-center text-xl font-bold font-mono",style:{color:o.color,borderColor:`${o.color}60`},children:o.level}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-[10px] text-slate-400 uppercase font-bold tracking-wider",children:"Survivor Level"}),a.jsx("div",{className:"w-32 h-2 bg-slate-800 rounded-full overflow-hidden mt-1",children:a.jsx("div",{className:"h-full bg-blue-500",style:{width:`${d}%`}})})]})]})}),a.jsx("div",{className:"flex flex-col items-center pt-2",children:a.jsxs("div",{className:"bg-gradient-to-b from-black/80 to-transparent px-8 pb-4 rounded-b-xl",children:[a.jsx("h1",{className:"text-4xl font-bold fantasy-font text-slate-100 drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)] tracking-widest",children:n}),a.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-500 font-mono font-bold mt-1 drop-shadow-md bg-black/40 px-3 py-0.5 rounded-full text-sm border border-red-900/30",children:[a.jsx(D,{size:14}),a.jsx("span",{children:e.toLocaleString()})]})]})}),a.jsxs("div",{className:"flex flex-col items-end gap-1 pointer-events-auto",children:[a.jsxs("div",{className:"flex gap-1 mb-1",children:[h.map((m,y)=>a.jsxs("div",{className:"group relative w-10 h-10 bg-slate-900/90 border border-slate-600 rounded shadow-lg flex items-center justify-center cursor-help",children:[a.jsx("div",{className:"absolute -top-1 -right-1 bg-black border border-slate-600 text-white text-[9px] w-4 h-4 flex items-center justify-center rounded-full font-bold z-10",children:m.level}),a.jsx("div",{className:"opacity-90",children:ie(m.id,!1)}),m.cooldownTimer>0&&a.jsx("div",{className:"absolute inset-0 bg-black/60 origin-bottom animate-pulse",style:{height:`${m.cooldownTimer/m.cooldown*100}%`}}),a.jsxs("div",{className:"absolute right-full top-0 mr-3 w-48 p-3 bg-slate-950/95 border border-slate-600 rounded-lg shadow-xl hidden group-hover:block z-50 text-left backdrop-blur-md animate-in fade-in slide-in-from-right-2 duration-200",children:[a.jsxs("h4",{className:"text-sm font-bold text-yellow-400 mb-1 flex justify-between items-center",children:[m.name,a.jsxs("span",{className:"text-[10px] text-slate-500 bg-slate-900 px-1.5 py-0.5 rounded border border-slate-800",children:["LVL ",m.level]})]}),a.jsx("div",{className:"h-px w-full bg-slate-800 mb-2"}),a.jsx("p",{className:"text-[11px] text-slate-300 leading-relaxed font-medium",children:m.description}),a.jsxs("div",{className:"mt-2 text-[10px] text-slate-500 font-mono flex gap-2",children:[a.jsxs("span",{children:["DMG: ",Math.round(m.damage)]}),a.jsxs("span",{children:["CD: ",(m.cooldown/60).toFixed(1),"s"]})]})]})]},`w-${y}`)),x.map((m,y)=>a.jsx("div",{className:"w-10 h-10 bg-black/40 border border-slate-800 rounded flex items-center justify-center",children:a.jsx("div",{className:"w-1 h-1 rounded-full bg-slate-800"})},`we-${y}`))]}),a.jsxs("div",{className:"flex gap-1",children:[p.map((m,y)=>a.jsxs("div",{className:"group relative w-8 h-8 bg-slate-900/90 border border-slate-700 rounded shadow-lg flex items-center justify-center cursor-help",children:[a.jsx("div",{className:"absolute -bottom-1 -right-1 bg-black border border-slate-700 text-slate-300 text-[8px] w-3 h-3 flex items-center justify-center rounded-full font-bold z-10",children:m.level}),a.jsx("div",{className:"opacity-80",children:ie(m.id,!0)}),a.jsxs("div",{className:"absolute right-full bottom-0 mr-3 w-40 p-3 bg-slate-950/95 border border-slate-700 rounded-lg shadow-xl hidden group-hover:block z-50 text-left backdrop-blur-md animate-in fade-in slide-in-from-right-2 duration-200",children:[a.jsxs("h4",{className:"text-xs font-bold text-blue-300 mb-1 flex justify-between items-center",children:[m.name,a.jsxs("span",{className:"text-[9px] text-slate-500",children:["LVL ",m.level]})]}),a.jsx("div",{className:"h-px w-full bg-slate-800 mb-2"}),a.jsx("p",{className:"text-[10px] text-slate-400 leading-relaxed",children:m.description})]})]},`p-${y}`)),u.map((m,y)=>a.jsx("div",{className:"w-8 h-8 bg-black/20 border border-slate-900 rounded flex items-center justify-center",children:a.jsx("div",{className:"w-1 h-1 rounded-full bg-slate-900"})},`pe-${y}`))]})]})]}),i&&a.jsx("div",{className:"absolute top-32 left-1/2 -translate-x-1/2 bg-black/70 text-purple-200 px-8 py-3 rounded border border-purple-900/50 backdrop-blur animate-in slide-in-from-top-4 fade-in duration-500 text-center max-w-lg shadow-[0_0_30px_rgba(147,51,234,0.2)]",children:a.jsxs("span",{className:"fantasy-font italic text-xl tracking-wide",children:['"',i,'"']})}),a.jsx("div",{className:"self-center w-full max-w-xl mb-6",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute -left-4 top-1/2 -translate-y-1/2 z-10 bg-slate-900 border-2 border-red-900 rounded-full p-1.5 shadow-lg",children:a.jsx("div",{className:`w-3 h-3 rounded-full bg-red-500 ${t<30?"animate-ping":""}`})}),a.jsxs("div",{className:"w-full h-5 bg-slate-950 rounded-full border border-slate-700 overflow-hidden relative shadow-lg",children:[a.jsx("div",{className:"h-full transition-all duration-200 ease-out relative",style:{width:`${t}%`,backgroundColor:t<30?"#ef4444":o.color,boxShadow:`0 0 10px ${o.color}`},children:a.jsx("div",{className:"absolute top-0 left-0 w-full h-[50%] bg-white/20"})}),a.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-bold text-white/90 drop-shadow-md tracking-wider font-mono",children:[Math.ceil(o.hp)," / ",Math.ceil(o.maxHp)," HP"]})]})]})})]})},Qe=({upgrades:o,onSelect:e})=>a.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 animate-in fade-in duration-300",children:a.jsxs("div",{className:"bg-slate-900 border-2 border-yellow-600/50 rounded-lg p-8 max-w-4xl w-full shadow-2xl shadow-yellow-900/20",children:[a.jsx("h2",{className:"text-4xl text-center text-yellow-500 fantasy-font mb-2 drop-shadow-lg",children:"Level Up!"}),a.jsx("p",{className:"text-center text-slate-400 mb-8 italic",children:"Choose your destiny..."}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:o.map(s=>{const i=s.rarity==="legendary";return a.jsxs("button",{onClick:()=>e(s),className:`group relative border p-6 rounded transition-all duration-200 text-left flex flex-col gap-2 ${i?"bg-purple-900/40 border-purple-500 hover:bg-purple-900/60 shadow-[0_0_20px_rgba(168,85,247,0.3)] hover:scale-105":"bg-slate-800 border-slate-600 hover:bg-slate-700 hover:border-yellow-500 hover:-translate-y-1"}`,children:[a.jsx("div",{className:`absolute -inset-0.5 rounded blur transition duration-500 ${i?"bg-gradient-to-r from-purple-600 via-pink-600 to-purple-600 opacity-50 group-hover:opacity-75 animate-pulse":"bg-gradient-to-r from-yellow-600 to-purple-600 opacity-0 group-hover:opacity-30"}`}),i&&a.jsxs("div",{className:"absolute -top-3 -right-3 bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg flex items-center gap-1 animate-bounce z-10",children:[a.jsx(re,{size:12})," EVOLUTION"]}),a.jsxs("div",{className:"relative z-10",children:[a.jsx("h3",{className:`text-xl font-bold ${i?"text-purple-100 group-hover:text-purple-50":"text-yellow-100 group-hover:text-yellow-400"}`,children:s.name}),a.jsx("span",{className:`text-xs uppercase tracking-wider font-bold ${i?"text-purple-300":s.rarity==="rare"?"text-blue-400":"text-slate-500"}`,children:s.rarity}),a.jsx("p",{className:`text-sm mt-2 leading-relaxed ${i?"text-purple-200":"text-slate-300"}`,children:s.description})]})]},s.id)})})]})}),Ze=({onStart:o,onAchievements:e,onLibrary:s,onPowerUp:i,stats:l})=>{const[r,n]=v.useState("MAIN");return r==="CHAR_SELECT"?a.jsx("div",{className:"absolute inset-0 flex flex-col items-center bg-slate-950 z-50 overflow-y-auto p-6",children:a.jsxs("div",{className:"max-w-6xl w-full",children:[a.jsxs("div",{className:"flex justify-between items-center mb-8 border-b border-slate-800 pb-4 sticky top-0 bg-slate-950 z-20 py-4",children:[a.jsxs("button",{onClick:()=>n("MAIN"),className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors",children:[a.jsx(Re,{size:20})," Back"]}),a.jsx("h2",{className:"text-4xl text-red-500 fantasy-font",children:"Select Survivor"}),a.jsx("div",{className:"w-16"})," "]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-8",children:C.map(d=>{const t=d.isUnlocked(l),c=t?d.color:"#334155",h=t?`${d.color}40`:"transparent";return a.jsxs("button",{onClick:()=>t&&o(d.id),disabled:!t,className:`relative group text-left rounded-xl overflow-hidden border-2 transition-all duration-300 ${t?"hover:-translate-y-1 hover:shadow-2xl":"opacity-70 cursor-not-allowed grayscale-[0.8]"}`,style:{borderColor:c,backgroundColor:"#0f172a",boxShadow:t?`0 0 15px ${h}`:"none"},children:[t&&a.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity duration-300 pointer-events-none",style:{background:`linear-gradient(135deg, ${d.color} 0%, transparent 100%)`}}),a.jsxs("div",{className:"relative p-5 z-10 flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:`text-2xl font-bold fantasy-font leading-none mb-1 ${t?"text-slate-100":"text-slate-500"}`,children:d.name}),a.jsx("span",{className:`text-xs font-bold uppercase tracking-widest ${t?"opacity-80":"text-slate-600"}`,style:{color:t?d.color:void 0},children:d.title})]}),a.jsx("div",{className:"w-12 h-12 rounded-lg border-2 shadow-inner flex items-center justify-center bg-slate-800 shrink-0",style:{borderColor:t?d.color:"#334155"},children:t?a.jsx(Z,{style:{color:d.color}}):a.jsx(ee,{className:"text-slate-600"})})]}),a.jsx("div",{className:"flex-1 mb-6",children:t?a.jsxs("p",{className:"text-slate-400 text-sm italic leading-relaxed border-l-2 border-slate-700 pl-3",children:['"',d.description,'"']}):a.jsxs("div",{className:"bg-red-950/40 border border-red-900/30 p-3 rounded flex items-start gap-3 mt-2",children:[a.jsx(ee,{size:16,className:"text-red-400 shrink-0 mt-0.5"}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-red-400 text-[10px] font-bold uppercase",children:"Locked"}),a.jsx("p",{className:"text-red-200/70 text-xs font-medium",children:d.unlockCondition})]})]})}),a.jsxs("div",{className:"bg-slate-950/60 rounded p-3 grid grid-cols-2 gap-2 text-xs border border-slate-800/50",children:[a.jsxs("div",{className:"flex items-center gap-2 text-slate-300",title:"Max Health",children:[a.jsx(oe,{size:14,className:t?"text-red-500":"text-slate-600"}),a.jsxs("span",{className:"font-mono",children:[d.baseStats.maxHp," HP"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-slate-300",title:"Movement Speed",children:[a.jsx($,{size:14,className:t?"text-blue-400":"text-slate-600"}),a.jsxs("span",{className:"font-mono",children:[d.baseStats.speed," Spd"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-slate-300",title:"Might",children:[a.jsx(A,{size:14,className:t?"text-orange-500":"text-slate-600"}),a.jsxs("span",{className:"font-mono",children:[Math.round(d.baseStats.might*100),"% Dmg"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-slate-300",title:"Area",children:[a.jsx(le,{size:14,className:t?"text-cyan-500":"text-slate-600"}),a.jsxs("span",{className:"font-mono",children:[Math.round(d.baseStats.area*100),"% Area"]})]})]}),t&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-20 pointer-events-none",children:a.jsx("div",{className:"bg-black/60 backdrop-blur-sm px-6 py-2 rounded border border-white/20 text-white font-bold tracking-widest shadow-xl transform scale-90 group-hover:scale-100 transition-transform",children:"START"})})]})]},d.id)})})]})}):a.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/90 z-50",children:[a.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-red-900/20 via-slate-900 to-black pointer-events-none"}),a.jsx("h1",{className:"text-6xl md:text-8xl text-red-600 fantasy-font mb-2 drop-shadow-[0_0_15px_rgba(220,38,38,0.8)] text-center animate-pulse",children:"CRIMSON SURVIVOR"}),a.jsx("p",{className:"text-slate-500 font-mono mb-12 text-sm tracking-[0.5em] uppercase",children:"The Night is Endless"}),a.jsxs("div",{className:"flex flex-col gap-4 w-full max-w-xs z-10",children:[a.jsxs("button",{onClick:()=>n("CHAR_SELECT"),className:"group flex items-center justify-center gap-3 px-8 py-4 bg-red-800 hover:bg-red-700 text-white rounded border border-red-600 transition-all hover:scale-105 shadow-[0_0_20px_rgba(220,38,38,0.4)]",children:[a.jsx(ne,{size:24,className:"group-hover:fill-current"}),a.jsx("span",{className:"font-bold text-xl tracking-wider",children:"START GAME"})]}),a.jsxs("button",{onClick:i,className:"flex items-center justify-center gap-2 px-4 py-3 bg-yellow-900/40 hover:bg-yellow-900/60 text-yellow-200 rounded border border-yellow-700/50 transition-all hover:text-white hover:scale-105",children:[a.jsx(O,{size:20,className:"fill-yellow-400 text-yellow-400"}),a.jsx("span",{className:"font-bold text-lg tracking-wider",children:"POWER UP"})]}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("button",{onClick:e,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-slate-800 hover:bg-slate-700 text-slate-200 rounded border border-slate-600 transition-all hover:text-white",children:[a.jsx(Le,{size:18}),a.jsx("span",{className:"font-bold text-sm tracking-wider",children:"RECORDS"})]}),a.jsxs("button",{onClick:s,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-slate-800 hover:bg-slate-700 text-slate-200 rounded border border-slate-600 transition-all hover:text-white",children:[a.jsx(_e,{size:18}),a.jsx("span",{className:"font-bold text-sm tracking-wider",children:"LIBRARY"})]})]})]}),a.jsxs("div",{className:"mt-16 text-slate-500 text-sm flex gap-8",children:[a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(D,{size:16,className:"mb-1"}),a.jsxs("span",{children:[l.totalKills.toLocaleString()," KILLS"]})]}),a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(Z,{size:16,className:"mb-1"}),a.jsxs("span",{children:[C.filter(d=>d.isUnlocked(l)).length," / ",C.length," CHARS"]})]})]})]})},et=({onResume:o,onQuit:e,stats:s})=>{const i=Math.floor(s.time/60),l=s.time%60,r=`${i.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`;return a.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:a.jsxs("div",{className:"bg-slate-900 border-2 border-slate-700 p-8 rounded-lg shadow-2xl max-w-md w-full relative",children:[a.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-red-900 to-transparent opacity-50"}),a.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-red-900 to-transparent opacity-50"}),a.jsx("h2",{className:"text-4xl text-white fantasy-font text-center mb-2 tracking-widest drop-shadow-md",children:"PAUSED"}),a.jsx("div",{className:"h-px w-24 bg-slate-600 mx-auto mb-6"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8 text-center text-slate-300 font-mono text-sm bg-slate-950/50 p-4 rounded border border-slate-800",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-slate-500 text-xs uppercase",children:"Time"}),a.jsx("span",{className:"text-lg text-yellow-500",children:r})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-slate-500 text-xs uppercase",children:"Level"}),a.jsx("span",{className:"text-lg text-blue-500",children:s.level})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-slate-500 text-xs uppercase",children:"Kills"}),a.jsx("span",{className:"text-lg text-red-500",children:s.kills})]})]}),a.jsxs("div",{className:"flex flex-col gap-4",children:[a.jsxs("button",{onClick:o,className:"group flex items-center justify-center gap-3 w-full py-4 bg-red-900/80 hover:bg-red-800 text-white rounded border border-red-700 hover:border-red-500 transition-all shadow-lg",children:[a.jsx(ne,{size:20,className:"fill-white group-hover:scale-110 transition-transform"}),a.jsx("span",{className:"font-bold tracking-wider",children:"RESUME GAME"})]}),a.jsx("div",{className:"h-px bg-slate-800 w-full my-1"}),a.jsxs("button",{onClick:e,className:"flex items-center justify-center gap-3 w-full py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white rounded border border-slate-700 transition-all",children:[a.jsx(Ae,{size:20}),a.jsx("span",{className:"font-bold tracking-wider",children:"QUIT TO MENU"})]})]}),a.jsx("p",{className:"text-center text-slate-600 text-xs mt-6 italic",children:'"Rest while you can, survivor."'})]})})},tt=({rewards:o,gold:e,onClose:s})=>{const[i,l]=v.useState("DROP"),[r,n]=v.useState([]);v.useEffect(()=>{if(i==="DROP"){const t=setTimeout(()=>l("SHAKE"),600);return()=>clearTimeout(t)}if(i==="SHAKE"){const t=setTimeout(()=>{l("OPEN"),d()},1200);return()=>clearTimeout(t)}if(i==="OPEN"){const t=setTimeout(()=>l("REVEAL"),1500);return()=>clearTimeout(t)}},[i]);const d=()=>{const t=[];for(let c=0;c<40;c++){const h=Math.random()*Math.PI*2,x=150+Math.random()*150;t.push({id:c,tx:Math.cos(h)*x,ty:Math.sin(h)*x,color:Math.random()>.3?"#fbbf24":"#ffffff"})}n(t)};return a.jsxs("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm",children:[a.jsx("style",{children:`
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        @keyframes beams {
            0% { opacity: 0; transform: scale(0.5) rotate(0deg); }
            20% { opacity: 1; }
            100% { opacity: 0; transform: scale(2) rotate(180deg); }
        }
        @keyframes particle {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(0); opacity: 0; }
        }
        .chest-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; }
        .beam-effect { animation: beams 1.5s ease-out forwards; }
        .particle-effect { animation: particle 1s ease-out forwards; }
      `}),a.jsxs("div",{className:"flex flex-col items-center justify-center w-full max-w-2xl p-8 relative",children:[i==="OPEN"&&a.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:[a.jsx("div",{className:"absolute w-[800px] h-[800px] bg-gradient-conic from-yellow-500/0 via-yellow-500/30 to-yellow-500/0 beam-effect rounded-full blur-xl z-0"}),r.map(t=>a.jsx("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 rounded-full particle-effect z-10",style:{backgroundColor:t.color,"--tx":`${t.tx}px`,"--ty":`${t.ty}px`}},t.id))]}),i!=="REVEAL"?a.jsxs("div",{className:`relative transition-all duration-300 transform 
                ${i==="DROP"?"scale-0 opacity-0 translate-y-[-100px] animate-in slide-in-from-top duration-500 fade-in zoom-in":"scale-125 opacity-100"}
                ${i==="SHAKE"?"chest-shake":""}
            `,children:[a.jsxs("div",{className:"w-64 h-48 relative",children:[a.jsxs("div",{className:"absolute bottom-0 w-full h-3/4 bg-gradient-to-b from-amber-800 to-amber-950 rounded-b-xl border-4 border-amber-600 shadow-2xl z-10 overflow-hidden",children:[a.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-6 bg-amber-600 border-x border-amber-900/50"}),a.jsx("div",{className:"absolute right-8 top-0 bottom-0 w-6 bg-amber-600 border-x border-amber-900/50"}),a.jsx("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 w-10 h-10 bg-black/40 rounded-full blur-[2px]"})]}),a.jsxs("div",{className:`absolute top-0 w-full h-2/5 bg-gradient-to-b from-amber-700 to-amber-900 rounded-t-xl border-4 border-b-0 border-amber-500 z-20 origin-bottom transition-transform duration-300 ease-out
                         ${i==="OPEN"?"-rotate-[120deg] -translate-y-12":"rotate-0"}
                     `,children:[a.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-full h-full bg-gradient-to-r from-transparent via-amber-400/10 to-transparent"}),a.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-6 bg-amber-600 border-x border-amber-900/50"}),a.jsx("div",{className:"absolute right-8 top-0 bottom-0 w-6 bg-amber-600 border-x border-amber-900/50"}),a.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 w-12 h-14 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded border-2 border-yellow-200 shadow-lg z-30 flex items-center justify-center",children:a.jsx("div",{className:"w-4 h-6 bg-black rounded-full"})})]}),a.jsx("div",{className:`absolute top-1/2 left-4 right-4 h-2 bg-yellow-200 blur-md transition-opacity duration-300 z-15 ${i==="OPEN"?"opacity-100":"opacity-0"}`})]}),i==="OPEN"&&a.jsx("div",{className:"absolute inset-0 bg-white animate-ping opacity-50 z-50 rounded-xl"})]}):a.jsxs("div",{className:"w-full flex flex-col items-center animate-in zoom-in duration-500",children:[a.jsx("h2",{className:"text-6xl text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 fantasy-font mb-4 drop-shadow-[0_0_15px_rgba(234,179,8,0.5)] tracking-widest",children:"TREASURE!"}),a.jsx("div",{className:"bg-gradient-to-r from-slate-900/80 via-yellow-900/30 to-slate-900/80 border-y border-yellow-700/50 w-full py-4 mb-8 flex justify-center",children:a.jsxs("div",{className:"bg-yellow-950/80 border border-yellow-600 rounded-full px-8 py-2 text-yellow-200 flex items-center gap-3 shadow-[0_0_10px_rgba(234,179,8,0.3)]",children:[a.jsx(Oe,{className:"text-yellow-400 fill-yellow-400/20",size:20}),a.jsxs("span",{className:"font-bold text-xl tracking-wide",children:["+",e," Gold"]})]})}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 w-full mb-10",children:[o.map((t,c)=>a.jsxs("div",{className:"group bg-slate-800/80 border-2 border-yellow-600/60 p-5 rounded-xl flex items-center gap-5 shadow-2xl animate-in slide-in-from-bottom-8 fade-in duration-700 fill-mode-backwards hover:border-yellow-400 transition-colors",style:{animationDelay:`${c*300}ms`},children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 bg-yellow-500 blur opacity-20 group-hover:opacity-40 transition-opacity"}),a.jsx("div",{className:"bg-slate-900 p-4 rounded-full border border-yellow-700 relative z-10",children:a.jsx(re,{className:"text-yellow-400",size:28})})]}),a.jsxs("div",{className:"flex-1 text-left",children:[a.jsx("h3",{className:"text-2xl font-bold text-yellow-100 mb-1",children:t.name}),a.jsx("p",{className:"text-yellow-200/60 font-mono text-sm",children:t.description})]}),a.jsx("div",{className:"text-xs uppercase font-bold text-green-300 bg-green-900/40 px-3 py-1.5 rounded border border-green-500/30",children:"LEVEL UP"})]},c)),o.length===0&&a.jsx("div",{className:"text-center text-slate-500 italic p-4 border border-slate-800 rounded",children:"The chest contained only gold..."})]}),a.jsxs("button",{onClick:s,className:"group bg-gradient-to-r from-yellow-700 to-yellow-600 hover:from-yellow-600 hover:to-yellow-500 text-white font-bold py-4 px-16 rounded-lg shadow-[0_0_30px_rgba(202,138,4,0.3)] transition-all hover:scale-105 hover:shadow-[0_0_50px_rgba(202,138,4,0.5)] flex items-center gap-3 border border-yellow-400/30",children:[a.jsx(De,{size:28,className:"group-hover:scale-110 transition-transform"}),a.jsx("span",{className:"text-xl",children:"CLAIM REWARDS"})]})]})]})]})},st=async o=>at(o.situation),at=(o,e)=>{const s=i=>i[Math.floor(Math.random()*i.length)];switch(o){case"LEVEL_UP":return s(["Power surges through your veins.","The abyss gazes back, and you blink not.","Your soul grows darker, yet stronger.","Ascension is inevitable.","More power. More blood.","You are becoming something else.","The shadows bow to you.","Limitless potential unleashed.","A new plateau of strength.","The ancient seals weaken."]);case"GAME_OVER":return s(["The darkness consumes you.","Your light has faded.","Rest now, warrior.","The horde was too many.","A valiant effort, extinguished.","Return to the void.","Your journey ends here.","Dust to dust.","The night claims another.","You fought well, but the shadows won."]);case"BOSS_SPAWN":return s(["A terrible presence approaches.","The ground trembles beneath you.","Something ancient has awoken.","Prepare yourself. It is here.","A titan of the void emerges.","Death comes for you.","Face your doom!","The air grows heavy with malice.","An entity of pure dread manifests.","The master of this realm descends."]);default:return"Survive."}},it=B.lazy(()=>Y(()=>import("./AchievementsScreen-DupY2OIZ.js"),__vite__mapDeps([0,1,2]),import.meta.url)),ot=B.lazy(()=>Y(()=>import("./LibraryScreen-CYeVD4YL.js"),__vite__mapDeps([3,2,1]),import.meta.url)),lt=B.lazy(()=>Y(()=>import("./PowerUpStore-TB3QimLD.js"),__vite__mapDeps([4,2,1]),import.meta.url)),V=()=>a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-950 z-50",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600"})}),rt=()=>{const o=v.useRef(null),e=v.useRef(null),[s,i]=v.useState(0),[l,r]=v.useState(null),[n,d]=v.useState(0),[t,c]=v.useState(0),[h,x]=v.useState([]),[p,u]=v.useState({rewards:[],gold:0}),[m,y]=v.useState(""),[M,P]=v.useState(L());v.useEffect(()=>{P(L())},[s===0]),v.useEffect(()=>{const w=k=>{k.code==="Escape"&&(s===4?F(!0):s===5&&F(!1))};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[s]);const F=w=>{e.current&&(w?(e.current.isPaused=!0,i(5)):(e.current.isPaused=!1,i(4)))},xe=w=>{if(!o.current)return;const k=new qe(o.current,w,E=>{x(E),i(6),z("LEVEL_UP",k)},E=>{i(7),z("GAME_OVER",k);const U=Ye(E);P(U)},()=>{z("BOSS_SPAWN",k)},()=>{pe(k)});e.current=k,k.start(),i(4),y("")},pe=w=>{const E=Math.random()<.2?3:1,U=Math.floor(Math.random()*200+100)*w.player.stats.greed,X=[],K=w.player.weapons.filter(N=>N.level<N.maxLevel);for(let N=0;N<E;N++)if(K.length>0){const fe=Math.floor(Math.random()*K.length),_=K[fe];X.push({id:`chest_upgrade_${_.id}_${Date.now()}_${N}`,name:R[_.id].name,description:`Upgraded to Level ${_.level+1}`,rarity:"rare",type:"WEAPON",apply:ye=>{const j=ye.weapons.find(ge=>ge.id===_.id);j.level<j.maxLevel&&(j.level++,j.level%2===0&&(j.damage*=1.2),j.level%3===0&&(j.amount+=1),j.area*=1.1)}})}u({rewards:X,gold:Math.floor(U)}),i(8)},me=()=>{e.current&&(p.rewards.forEach(w=>w.apply(e.current.player)),e.current.goldCollected+=p.gold,e.current.isPaused=!1,i(4))},z=async(w,k)=>{const E=await st({level:k.player.level,kills:k.score,healthPercent:k.player.hp/k.player.maxHp*100,situation:w});y(E),setTimeout(()=>y(""),4e3)};v.useEffect(()=>{let w;return(s===4||s===5)&&e.current&&(w=window.setInterval(()=>{const k=e.current;r({...k.player}),d(k.score),c(Math.floor(k.frameCount/60))},100)),()=>clearInterval(w)},[s]);const ue=w=>{e.current&&(w.apply(e.current.player),e.current.isPaused=!1,i(4))},I=()=>{e.current&&(e.current.isGameOver=!0),i(0)};return a.jsxs("div",{className:"relative w-full h-screen bg-slate-900 overflow-hidden",children:[a.jsx("canvas",{ref:o,className:"block w-full h-full"}),s===0&&a.jsx(Ze,{onStart:xe,onAchievements:()=>i(1),onLibrary:()=>i(2),onPowerUp:()=>i(3),stats:M}),s===1&&a.jsx(v.Suspense,{fallback:a.jsx(V,{}),children:a.jsx(it,{stats:M,onBack:I})}),s===2&&a.jsx(v.Suspense,{fallback:a.jsx(V,{}),children:a.jsx(ot,{stats:M,onBack:I})}),s===3&&a.jsx(v.Suspense,{fallback:a.jsx(V,{}),children:a.jsx(lt,{stats:M,onBack:I,onUpdateStats:w=>P(w)})}),(s===4||s===5)&&a.jsx(Xe,{player:l,score:n,time:t,flavorText:m}),s===5&&l&&a.jsx(et,{onResume:()=>F(!1),onQuit:I,stats:{kills:n,time:t,level:l.level}}),s===6&&a.jsx(Qe,{upgrades:h,onSelect:ue}),s===8&&a.jsx(tt,{rewards:p.rewards,gold:p.gold,onClose:me}),s===7&&a.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-red-900/90 backdrop-blur z-50 animate-in zoom-in duration-500",children:[a.jsx("h2",{className:"text-6xl text-white fantasy-font mb-4 drop-shadow-lg",children:"YOU DIED"}),a.jsxs("div",{className:"text-center mb-8 bg-black/40 p-6 rounded-lg border border-red-500/30",children:[a.jsxs("p",{className:"text-2xl text-red-200 mb-2",children:["Survived: ",Math.floor(t/60),"m ",t%60,"s"]}),a.jsxs("p",{className:"text-2xl text-red-200",children:["Kills: ",n]}),a.jsxs("p",{className:"text-xl text-slate-400 mt-4",children:["Level Reached: ",l==null?void 0:l.level]}),m&&a.jsxs("p",{className:"text-lg italic text-red-300 mt-4 border-t border-red-500/20 pt-4",children:['"',m,'"']})]}),a.jsx("div",{className:"flex gap-4",children:a.jsx("button",{onClick:I,className:"px-8 py-4 bg-white text-red-900 hover:bg-slate-200 rounded text-xl font-bold transition-all border border-red-800",children:"BACK TO MENU"})})]})]})},he=document.getElementById("root");if(!he)throw new Error("Could not find root element to mount to");const nt=J.createRoot(he);nt.render(a.jsx(B.StrictMode,{children:a.jsx(rt,{})}));export{xt as A,C,$e as P,R as W,b as a,Je as b,a as j,pt as p};
